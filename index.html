<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategic Market Position Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        /* --- NAV BUTTON FIX (2026 Dashboard Standard) --- */
        .nav-tabs-container {
            display: flex;
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }
        .nav-tabs-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }
        .nav-btn {
            padding: 0.5rem 0.8rem; 
            font-size: 0.75rem; 
            font-weight: 500; 
            background-color: #F3F4F6; 
            color: #4B5563; 
            border-radius: 0.5rem 0.5rem 0 0; 
            cursor: pointer;
            transition: background-color 0.3s, color: 0.3s;
            border-bottom: 4px solid transparent;
            margin-right: 0.25rem;
            margin-bottom: 0.5rem; 
            white-space: nowrap;
            flex: 0 0 auto; /* Prevent squishing on iPhone */
        }
        .nav-btn:hover {
            background-color: #60A5FA; 
            color: white;
            border-bottom-color: #60A5FA;
        }
        .nav-btn.active {
            background-color: #1D4ED8; 
            color: white;
            font-weight: 700; 
            border-bottom: 4px solid #1D4ED8;
        }
        /* --- COMP SUB-NAV FIX --- */
        .sub-nav-btn {
            @apply px-4 py-2 text-xs font-medium rounded-full transition-colors duration-200 border border-gray-300;
        }
        .sub-nav-btn.active {
            @apply bg-blue-600 text-white border-blue-600;
        }
        .kpi-card {
            @apply bg-white shadow-lg rounded-lg p-6 flex flex-col justify-center items-center transition-transform hover:scale-105;
        }
        .kpi-title {
            @apply text-sm font-medium text-gray-500 uppercase tracking-wider;
        }
        .kpi-value {
            @apply text-3xl md:text-4xl font-extrabold text-stone-700 mt-2;
        }
        .kpi-sub {
            @apply text-sm text-gray-400;
        }
        .page-section {
            @apply bg-white shadow-lg rounded-lg p-6 md:p-8;
        }
        main > div {
            @apply bg-white rounded-b-lg shadow-lg;
        }
        .data-table th, .data-table td {
             @apply p-3 whitespace-nowrap;
        }
        .data-table thead {
            @apply text-xs text-gray-700 uppercase bg-gray-100;
        }
        /* Custom styles for bold text in Executive Summary to match original request */
        .summary-bold { font-weight: 700; }
        .summary-red { color: #dc2626; font-weight: 700; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen">

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <!-- Glass-morphism Header -->
        <header class="relative py-8 md:py-12 text-center border-b border-gray-200/50 backdrop-blur-xl bg-white/80">
            <div class="absolute inset-0 bg-gradient-to-b from-white/90 to-white/70"></div>
            <div class="relative z-10">
                <img src="logo.png" alt="Logo" class="mx-auto mb-4" style="height: 160px; width: auto; object-fit: contain;">
                <h1 class="text-3xl md:text-4xl font-extrabold text-stone-800">Strategic Market Position Analysis</h1>
                <p class="text-lg font-medium text-gray-600 mt-2" id="header-address">3433 Morning Star Ln, Garland, TX 75043</p>
            </div>
        </header>

        <!-- 13-Tab Navigation Ribbon -->
        <nav class="border-b border-gray-200 sticky top-0 bg-gray-50/95 backdrop-blur-sm z-10" id="main-nav-container">
            <div class="nav-tabs-container justify-center pt-4 pb-0">
                <button id="nav-summary" class="nav-btn active" onclick="showTab('summary')">Executive Summary</button>
                <button id="nav-metrics" class="nav-btn" onclick="showTab('metrics')">Key Pricing Metrics</button>
                <button id="nav-property" class="nav-btn" onclick="showTab('property')">Property Analysis</button>
                <button id="nav-comps" class="nav-btn" onclick="showTab('comps')">Comparable Properties</button>
                <button id="nav-rates" class="nav-btn" onclick="showTab('rates')">Market Rate Update</button>
                <button id="nav-liquidity" class="nav-btn" onclick="showTab('liquidity')">Liquidity Risk</button>
                <button id="nav-campaign" class="nav-btn" onclick="showTab('campaign')">Campaign Strategy</button>
                <button id="nav-documents" class="nav-btn" onclick="showTab('documents')">Documents</button>
                <button id="nav-options" class="nav-btn" onclick="showTab('options')">Comparative Options</button>
                <button id="nav-option1" class="nav-btn" onclick="showTab('option1')">120-Day Price Strategy</button>
                <button id="nav-option2" class="nav-btn" onclick="showTab('option2')">3-2-1 Buydown Details</button>
                <button id="nav-option3" class="nav-btn" onclick="showTab('option3')">Owner Finance Details</button>
                <button id="nav-roadmap" class="nav-btn" onclick="showTab('roadmap')">Pricing Roadmap</button>
                <button id="nav-financial" class="nav-btn" onclick="showTab('financial')">Financial Analysis</button>
            </div>
        </nav>

        <main class="mb-12">
            <!-- 1. EXECUTIVE SUMMARY PAGE -->
            <div id="tab-summary" class="py-8 md:py-12">
                <div class="page-section max-w-4xl mx-auto">
                    <h2 class="text-3xl font-extrabold text-blue-700 text-center mb-6">
                        Strategic Market Position Analysis: Price Correction for Rapid Sale
                    </h2>
                    <h3 class="text-xl font-semibold text-gray-700 text-center mb-8" id="summary-address"></h3>
                    
                    <!-- HERO SECTION: Property Image LEFT, Google Map RIGHT -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <!-- Property Image on LEFT -->
                        <div class="h-[450px] rounded-3xl shadow-xl overflow-hidden">
                            <img src="3433_Morning_Star_Front_View.png" alt="Main property view" class="w-full h-full object-cover">
                        </div>
                        <!-- Google Map on RIGHT -->
                        <div class="h-[450px] rounded-3xl shadow-xl overflow-hidden relative">
                            <iframe 
                                src="https://www.google.com/maps?q=3433+Morning+Star+Ln,+Garland,+TX+75043&output=embed"
                                width="100%" 
                                height="100%" 
                                style="border:0;" 
                                allowfullscreen="" 
                                loading="lazy" 
                                referrerpolicy="no-referrer-when-downgrade"
                                class="w-full h-full">
                            </iframe>
                            <div class="absolute bottom-3 right-3 z-10">
                                <a 
                                    href="https://maps.app.goo.gl/eAtgZ7bWPf5EvVS86" 
                                    target="_blank" 
                                    rel="noopener noreferrer"
                                    class="bg-white px-4 py-2 rounded-md shadow-lg text-sm font-medium text-blue-600 hover:bg-blue-50 transition-colors flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                                    </svg>
                                    Open in Google Maps
                                </a>
                            </div>
                            <div class="absolute top-3 left-3 z-10 bg-white/95 backdrop-blur-sm px-3 py-2 rounded-md shadow-md">
                                <p class="text-gray-800 font-semibold text-sm">3433 Morning Star Ln</p>
                                <p class="text-gray-600 text-xs">Garland, TX 75043</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="prose max-w-none text-gray-600 space-y-6">
                        <p class="text-lg font-extrabold text-gray-800 border-l-4 border-blue-500 pl-4">
                            This report outlines a strategic pricing plan designed to meet the seller's mandated starting price of <span class="summary-bold" id="summary-price"></span> and secure a contract within a <span class="summary-red">120-day timeline</span>. The property's value is supported by major structural upgrades, but the high anchor price (25% above average closed PPSF) requires an aggressive, timed correction.
                        </p>
                        <h4 class="text-2xl font-semibold text-blue-700 pt-4"><span class="summary-bold">Core Findings & Strategic Mandates:</span></h4>
                        <ul class="list-disc list-inside space-y-2 pl-4">
                            <li><span class="summary-bold">Pricing Anchor:</span> The mandated starting price ($375,000 / $186.29/\text{SqFt}$) sits well above the AVM estimate of $343,480, meaning market time will be spent dropping the price toward a proven accepted price floor.</li>
                            <li><span class="summary-bold">Liquidity Risk:</span> As a **new listing (0 CDOM)**, velocity is key. The market average closing time (74 days) dictates that the price must be reduced quickly if an offer is not received by Day 40.</li>
                            <li><span class="summary-bold">Strategy:</span> A comprehensive, 6-step price reduction schedule over 120 days is mandatory. This plan is designed to surgically drop the price to the market-validated floor of <span class="summary-bold" id="summary-floor"></span> if the premium anchor fails to deliver a contract.</li>
                        </ul>
                    </div>
                    <div class="mt-8 text-center">
                         <button class="bg-blue-600 text-white py-3 px-8 rounded-lg shadow-lg hover:bg-blue-700 transition" data-page-target="options">
                            Explore Financing and Pricing Options
                        </button>
                    </div>
                    <div class="mt-8 pt-6 border-t border-gray-200">
                        <p class="text-sm italic text-gray-600 text-center max-w-3xl mx-auto">
                            <span class="font-semibold">Expert Note:</span> The Garland market velocity demands strategic positioning. This property's <span class="font-semibold">Solar/Roof/Foundation</span> structural upgrades provide critical risk mitigation and energy efficiency that justify premium pricing. However, market dynamics require a phased approach to maximize seller returns while ensuring timely liquidity in this competitive landscape.
                        </p>
                    </div>
                </div>
            </div>

            <!-- 2. KEY METRICS PAGE -->
            <div id="tab-metrics" class="py-8 md:py-12 hidden">
                <div class="text-center mb-10">
                    <h2 class="text-2xl font-semibold text-gray-700">Strategic Pricing & Velocity Snapshot</h2>
                    <p class="mt-2 text-gray-500 max-w-2xl mx-auto">The 120-day price reduction schedule is designed to achieve the $349,900 price floor necessary to secure a sale within the target timeline.</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-12 px-6 sm:px-8">
                    <div class="kpi-card">
                        <span class="kpi-title">Initial List Price</span>
                        <span class="kpi-value">$375,000</span>
                        <span class="kpi-sub">Seller Mandated Anchor Price</span>
                    </div>
                    <div class="kpi-card">
                        <span class="kpi-title">Target Sales Timeline</span>
                        <span class="kpi-value text-red-600">120 Days</span>
                        <span class="kpi-sub">Total time to contract</span>
                    </div>
                    <div class="kpi-card">
                        <span class="kpi-title">Price Floor (Day 120)</span>
                        <span class="kpi-value text-blue-700">$349,900</span>
                        <span class="kpi-sub">Total Reduction: 6.70%</span>
                    </div>
                    <div class="kpi-card">
                        <span class="kpi-title">Total Market Exposure (CDOM)</span>
                        <span class="kpi-value text-green-600">0 Days</span>
                        <span class="kpi-sub">New Listing Start</span>
                    </div>
                </div>

                <div class="page-section mx-6 sm:mx-8">
                    <h3 class="text-xl font-semibold text-gray-700 text-center mb-6">Aggressive Pricing Trajectory ($/SqFt)</h3>
                    <p class="text-gray-500 text-center max-w-xl mx-auto mb-6">The planned reductions target a $173.80/SqFt benchmark by Day 120, aligning with validated closed comps in the RPR data set.</p>
                    <div class="chart-container">
                        <canvas id="pricingStrategyChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- 3. PROPERTY ANALYSIS PAGE -->
            <div id="tab-property" class="py-8 md:py-12 hidden">
                <h2 class="text-2xl font-semibold text-gray-700 text-center mb-10">Subject Property Analysis: 3433 Morning Star Ln, Garland</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 px-6 sm:px-8">
                    
                    <div class="page-section">
                        <h3 class="text-xl font-semibold text-gray-700 mb-6">Core Asset Profile & Quality</h3>
                        
                        <div class="mb-6">
                            <h4 class="font-medium text-gray-800 mb-2">Location & Status</h4>
                            <div class="relative w-full h-64 md:h-80 rounded-lg shadow-md border border-gray-200 overflow-hidden">
                                <iframe 
                                    src="https://www.google.com/maps?q=3433+Morning+Star+Ln,+Garland,+TX+75043&output=embed"
                                    width="100%" 
                                    height="100%" 
                                    style="border:0;" 
                                    allowfullscreen="" 
                                    loading="lazy" 
                                    referrerpolicy="no-referrer-when-downgrade"
                                    class="w-full h-full">
                                </iframe>
                                <div class="absolute bottom-3 right-3 z-10">
                                    <a 
                                        href="https://maps.app.goo.gl/eAtgZ7bWPf5EvVS86" 
                                        target="_blank" 
                                        rel="noopener noreferrer"
                                        class="bg-white px-4 py-2 rounded-md shadow-lg text-sm font-medium text-blue-600 hover:bg-blue-50 transition-colors flex items-center gap-2">
                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                                        </svg>
                                        Open in Google Maps
                                    </a>
                                </div>
                                <div class="absolute top-3 left-3 z-10 bg-white/95 backdrop-blur-sm px-3 py-2 rounded-md shadow-md">
                                    <p class="text-gray-800 font-semibold text-sm">3433 Morning Star Ln</p>
                                    <p class="text-gray-600 text-xs">Garland, TX 75043</p>
                                </div>
                            </div>
                        </div>
                        
                        <ul class="space-y-4 text-gray-600">
                            <li class="flex justify-between items-center"><span class="font-medium text-gray-800">Gross Living Area (GLA):</span> 2,004 SqFt</li>
                            <li class="flex justify-between items-center"><span class="font-medium text-gray-800">Bedrooms/Baths:</span> 3 Bedrooms / 2 Baths</li>
                            <li class="flex justify-between items-center"><span class="font-medium text-gray-800">Year Built:</span> <span class="text-stone-700 summary-bold">1984 (Resale)</span></li>
                            <li class="flex justify-between items-center"><span class="font-medium text-gray-800">List Price (Anchor):</span> <span class="text-red-600 summary-bold">$375,000</span></li>
                            <li class="flex justify-between items-center"><span class="font-medium text-gray-800">Price/SqFt (Anchor):</span> <span class="text-red-600 summary-bold">$186.29</span></li>
                            <li class="flex justify-between items-center"><span class="font-medium text-gray-800">Lot Size:</span> 0.34 Acres (Approx)</li>
                            <li class="flex justify-between items-center"><span class="font-medium text-gray-800">CDOM:</span> 0 Days (New Listing)</li>
                        </ul>
                    </div>
                    
                    <div class="page-section">
                        <h3 class="text-xl font-semibold text-gray-700 mb-6">Comparative Strengths & Market Position</h3>
                        <p class="text-gray-500 mb-6">The value of this property is highly dependent on the recent capital improvements and risk-mitigating investments made by the seller.</p>

                        <div class="space-y-4">
                            <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-r-lg">
                                <h4 class="font-bold text-green-800">Major Structural & Utility Updates</h4>
                                <ul class="list-disc list-inside text-green-700 mt-2">
                                    <li>New <span class="summary-bold">Solar Panels</span> (Utility Savings).</li>
                                    <li>New <span class="summary-bold">2-Year-Old Roof</span> (Warranty value).</li>
                                    <li><span class="summary-bold">10 Foundation Piers Added</span> (<span class="summary-bold">Transferable Lifetime Warranty</span> - critical risk mitigation).</li>
                                </ul>
                            </div>
                            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg">
                                <h4 class="font-bold text-blue-800">Aesthetic & Maintenance Upgrades</h4>
                                <ul class="list-disc list-inside text-blue-700 mt-2">
                                    <li>Modestly updated and <span class="summary-bold">very clean/immaculate</span> condition.</li>
                                    <li>Upgraded <span class="summary-bold">cabinetry</span> and enlarged front drive/walkway design.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 3D Virtual Tour Section -->
                    <div class="page-section mt-8">
                        <h3 class="text-xl font-semibold text-gray-700 mb-6">3D Virtual Tour</h3>
                        <div class="relative w-full h-[600px] rounded-lg shadow-xl border border-gray-200 overflow-hidden">
                            <iframe 
                                src="https://my.matterport.com/show/?m=cTSxrKFZQvR&play=1&mls=2"
                                id="matterport-embed"
                                width="100%" 
                                height="100%" 
                                frameborder="0" 
                                allowfullscreen
                                allow="xr-spatial-tracking"
                                class="w-full h-full">
                            </iframe>
                            <div class="absolute top-3 right-3 z-10">
                                <a 
                                    href="https://my.matterport.com/show/?m=cTSxrKFZQvR" 
                                    target="_blank" 
                                    rel="noopener noreferrer"
                                    class="bg-white px-4 py-2 rounded-md shadow-lg text-sm font-medium text-blue-600 hover:bg-blue-50 transition-colors flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                                    </svg>
                                    View 3D Tour
                                </a>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            
            <!-- 4. COMPARABLE PROPERTIES MASTER PAGE -->
            <div id="tab-comps" class="py-8 md:py-12 hidden">
                <h2 class="text-2xl font-semibold text-gray-700 text-center mb-4">Comparable Properties Overview (3 Data Sets)</h2>
                <p class="text-gray-500 text-center max-w-2xl mx-auto mb-8">This section analyzes the market from three critical angles: local neighborhood pricing, AVM/RPR data, and immediate price-point competition.</p>

                <!-- SUB-TAB NAVIGATION -->
                <div class="flex justify-center flex-wrap space-x-2 mb-8 mx-6" id="comp-nav-tabs">
                    <button id="sub-neighborhood" class="nav-btn sub-nav-btn" data-comp="neighborhood">1. Neighborhood Proximity</button>
                    <button id="sub-avm" class="nav-btn sub-nav-btn" data-comp="avm">2. AVM via RPR/NTREIS</button>
                    <button id="sub-price_comp" class="nav-btn sub-nav-btn" data-comp="price_comp">3. Direct Price Competition</button>
                </div>

                <div id="sub-page-neighborhood" class="page-section mx-6 sm:mx-8 hidden">
                    <h3 class="text-xl font-semibold text-gray-700 mb-6">Data Set 1: Hideaway/Lindale Proximity & Desirability Comps</h3>
                    
                    <!-- LINKS BLOCK -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                        <div class="bg-gray-100 p-4 rounded-lg border-l-4 border-blue-500">
                            <h4 class="font-bold text-gray-800 mb-2">MLS Link: Neighborhood Proximity</h4>
                            <a href="#" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium break-all underline text-sm">
                                Link Not Provided - Source Data Only
                            </a>
                        </div>
                        <div class="bg-gray-100 p-4 rounded-lg border-l-4 border-blue-500">
                            <h4 class="font-bold text-gray-800 mb-2">Analysis Summary Sheet (Drive)</h4>
                            <a href="#" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium break-all underline text-sm">
                                Link Not Provided - Source Data Only
                            </a>
                        </div>
                    </div>
                    <!-- END LINKS BLOCK -->

                    <p class="text-gray-500 max-w-2xl mx-auto mb-8">This set establishes the baseline pricing for 1970s/1980s homes in the immediate Garland area, highlighting price clustering near the $330k mark.</p>

                    <div class="overflow-x-auto">
                        <h4 class="text-lg font-semibold text-gray-700 mt-6 mb-4">Active Listings (Subject highlighted)</h4>
                        <table class="w-full text-left text-sm text-gray-600 data-table">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-100"><tr><th class="p-3">MLS#</th><th class="p-3">Address, City</th><th class="p-3">Sqft</th><th class="p-3">YB</th><th class="p-3">Acres</th><th class="p-3">$/SqFt</th><th class="p-3">List Price</th><th class="p-3">CDOM</th></tr></thead>
                            <tbody id="ds1-active-table" class="divide-y"></tbody>
                        </table>
                        
                        <h4 class="text-lg font-semibold text-gray-700 mt-6 mb-4">Pending Listings</h4>
                        <table class="w-full text-left text-sm text-gray-600 data-table">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-100"><tr><th class="p-3">MLS#</th><th class="p-3">Address, City</th><th class="p-3">Sqft</th><th class="p-3">YB</th><th class="p-3">Acres</th><th class="p-3">$/SqFt</th><th class="p-3">List Price</th></tr></thead>
                            <tbody id="ds1-pending-table" class="divide-y"></tbody>
                        </table>

                        <h4 class="text-lg font-semibold text-gray-700 mt-6 mb-4">Closed Sales</h4>
                        <table class="w-full text-left text-sm text-gray-600 data-table">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-100"><tr><th class="p-3">MLS#</th><th class="p-3">Address, City</th><th class="p-3">Sqft</th><th class="p-3">YB</th><th class="p-3">Sold Price</th><th class="p-3">Sold Date</th><th class="p-3">S/L Ratio</th><th class="p-3">CDOM</th></tr></thead>
                            <tbody id="ds1-closed-table" class="divide-y"></tbody>
                        </table>
                    </div>
                </div>

                <!-- SUB-TAB CONTENT 2 (Data Set 2: AVM via RPR in NTREIS) -->
                <div id="sub-page-avm" class="page-section mx-6 sm:mx-8 hidden">
                    <h3 class="text-xl font-semibold text-gray-700 mb-6">Data Set 2: AVM (Automated Valuation Model) Analysis</h3>

                    <!-- LINKS BLOCK -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                        <div class="bg-gray-100 p-4 rounded-lg border-l-4 border-blue-500">
                            <h4 class="font-bold text-gray-800 mb-2">MLS Link: AVM Source</h4>
                            <a href="#" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium break-all underline text-sm">
                                Link Not Provided - Source Data Only
                            </a>
                        </div>
                        <div class="bg-gray-100 p-4 rounded-lg border-l-4 border-blue-500">
                            <h4 class="font-bold text-gray-800 mb-2">Analysis Summary Sheet (Drive)</h4>
                            <a href="#" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium break-all underline text-sm">
                                Link Not Provided - Source Data Only
                            </a>
                        </div>
                    </div>
                    <!-- END LINKS BLOCK -->

                    <h4 class="text-xl font-semibold text-blue-700 mb-4">Subject AVM RVM¬Æ Valuation</h4>
                    <div class="bg-gray-100 p-4 rounded-lg shadow-inner mb-8">
                         <div class="flex justify-between items-center"><span class="font-medium text-gray-800">RVM¬Æ Estimated Price:</span> <span class="text-2xl font-extrabold text-blue-700">$343,480</span></div>
                         <div class="flex justify-between items-center"><span class="font-medium text-gray-800">RVM¬Æ Price per SqFt:</span> <span class="text-lg font-semibold text-blue-700">$171</span></div>
                         <p class="text-sm text-gray-500 mt-2">The RVM estimate validates the ideal market value is around $343k, suggesting the $375k anchor price requires strong incentives to succeed.</p>
                    </div>

                    <p class="text-gray-500 max-w-2xl mx-auto mb-8">This dataset shows the direct impact of neighborhood comparable sales on the automated valuation model.</p>

                    <div class="overflow-x-auto">
                        <h4 class="text-lg font-semibold text-gray-700 mt-6 mb-4">Recently Closed & Off Market Properties (Used for RVM)</h4>
                        <table class="w-full text-left text-sm text-gray-600 data-table">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-100"><tr><th class="p-3">Status</th><th class="p-3">Address, City</th><th class="p-3">Sqft</th><th class="p-3">YB</th><th class="p-3">Sold Price</th><th class="p-3">$/SqFt</th><th class="p-3">CDOM</th></tr></thead>
                            <tbody id="ds2-closed-table" class="divide-y"></tbody>
                        </table>
                    </div>
                </div>

                <!-- SUB-TAB CONTENT 3 (Data Set 3: $300k-$400k Price Range) -->
                <div id="sub-page-price_comp" class="page-section mx-6 sm:mx-8 hidden">
                    <h3 class="text-xl font-semibold text-gray-700 mb-6">Data Set 3: Direct Price Competition ($300,000 - $400,000)</h3>

                    <!-- LINKS BLOCK -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                        <div class="bg-gray-100 p-4 rounded-lg border-l-4 border-blue-500">
                            <h4 class="font-bold text-gray-800 mb-2">MLS Link: Price Competition</h4>
                            <a href="#" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium break-all underline text-sm">
                                Link Not Provided - Source Data Only
                            </a>
                        </div>
                        <div class="bg-gray-100 p-4 rounded-lg border-l-4 border-blue-500">
                            <h4 class="font-bold text-gray-800 mb-2">Analysis Summary Sheet (Drive)</h4>
                            <a href="#" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium break-all underline text-sm">
                                Link Not Provided - Source Data Only
                            </a>
                        </div>
                    </div>
                    <!-- END LINKS BLOCK -->

                    <p class="text-gray-500 max-w-2xl mx-auto mb-8">This set shows all inventory currently competing with the Subject (Active, Pending, Closed). The data indicates a clear clustering of closed sales just below the Subject's asking price.</p>

                    <div class="overflow-x-auto">
                        <h4 class="text-lg font-semibold text-gray-700 mt-6 mb-4">Active Listings (Subject highlighted)</h4>
                        <table class="w-full text-left text-sm text-gray-600 data-table">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-100"><tr><th class="p-3">MLS#</th><th class="p-3">Address, City</th><th class="p-3">Sqft</th><th class="p-3">YB</th><th class="p-3">Acres</th><th class="p-3">$/SqFt</th><th class="p-3">List Price</th><th class="p-3">CDOM</th></tr></thead>
                            <tbody id="ds3-active-table" class="divide-y"></tbody>
                        </table>

                        <h4 class="text-lg font-semibold text-gray-700 mt-10 mb-4">Pending & Closed Listings</h4>
                        <table class="w-full text-left text-sm text-gray-600 data-table">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-100"><tr><th class="p-3">MLS#</th><th class="p-3">Address, City</th><th class="p-3">Sqft</th><th class="p-3">YB</th><th class="p-3">Sold Price</th><th class="p-3">Sold Date</th><th class="p-3">S/L Ratio</th><th class="p-3">CDOM</th></tr></thead>
                            <tbody id="ds3-pending-closed-table" class="divide-y"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 5. MARKET RATE UPDATE PAGE -->
            <div id="tab-rates" class="py-8 md:py-12 hidden">
                <h2 class="text-2xl font-semibold text-gray-700 text-center mb-10">Current Mortgage Market & Federal Reserve Context</h2>
                
                <div class="page-section max-w-4xl mx-auto space-y-8">
                    <div>
                        <h3 class="text-xl font-extrabold text-blue-700 mb-4 border-b pb-2 border-blue-100">Recent Volatility: The Hawkish Fed</h3>
                        <p class="text-gray-700 leading-relaxed">MBS volatility caused rates to sell off heavily last week following a <span class="font-extrabold">25bps Fed Funds Rate cut</span>. The volatility was driven by Chairman Jerome Powell's press conference, which was seen as <span class="font-extrabold text-red-600">hawkish</span>. Powell stated that a December cut was "far from a foregone conclusion," directly countering market expectations that a cut was a certainty.</p>
                        <p class="text-gray-700 leading-relaxed mt-3">The Fed voted 10-2 to implement the cut, with two dissenting members (one voting for no cut, one voting for a 50bps cut). This highlights internal disagreement regarding the speed and necessity of current rate adjustments.</p>
                    </div>

                    <div>
                        <h3 class="text-xl font-extrabold text-blue-700 mb-4 border-b pb-2 border-blue-100">Upcoming Economic Indicators</h3>
                        <p class="text-gray-700 leading-relaxed">Economic data remains limited due to the government shutdown, delaying critical reports like the October Jobs Report. The market is currently anticipating:</p>
                        <ul class="list-disc list-inside space-y-2 pl-4 text-gray-700">
                            <li>**ISM Manufacturing (Monday):** Forecast for 49.1%.</li>
                            <li>**ADP Employment:** Forecast for a negative reading of <span class="font-extrabold text-red-600">32,000 job losses</span>.</li>
                            <li>**ISM Services:** Forecast for 50.0%.</li>
                        </ul>
                        <p class="text-gray-700 leading-relaxed mt-3">Any surprise in these limited reports could trigger further short-term volatility in the mortgage bond market.</p>
                        <div class="mt-6 flex flex-wrap gap-4">
                            <a href="https://www.marketwatch.com/economy-politics/calendar" target="_blank" class="bg-gray-100 px-4 py-2 rounded-lg text-sm font-medium text-blue-600 hover:bg-gray-200">View MarketWatch Economic Calendar</a>
                            <a href="https://www.cmegroup.com/markets/interest-rates/cme-fedwatch-tool.html" target="_blank" class="bg-gray-100 px-4 py-2 rounded-lg text-sm font-medium text-blue-600 hover:bg-gray-200">View CME FedWatch Tool</a>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-xl font-extrabold text-blue-700 mb-4 border-b pb-2 border-blue-100">Future Fed Action</h3>
                        <p class="text-gray-700 leading-relaxed">Odds for a 25bps rate cut at the next meeting (December 10th) have fallen to about 70% post-Powell's comments. This upcoming meeting is a "Dot Plot" meeting, which means the Fed will release its summary of economic projections, including each member‚Äôs forecast for where the Fed Funds Rate will be in the future, providing a critical clue to long-term rate direction.</p>
                    </div>
                </div>
            </div>

            <!-- 6. LIQUIDITY RISK PAGE -->
            <div id="tab-liquidity" class="py-8 md:py-12 hidden">
                <h2 class="text-2xl font-semibold text-gray-700 text-center mb-10">Liquidity Risk Analysis: Cumulative Days on Market (CDOM)</h2>
                
                <div class="page-section max-w-4xl mx-auto px-6 sm:px-8">
                    <h3 class="text-xl font-semibold text-red-700 mb-4 border-b pb-2 border-red-100">
                        The Liquidity Challenge: 0 CDOM - Set Immediate Velocity
                    </h3>
                    <div class="prose max-w-none text-gray-600 space-y-4">
                        <p>
                            The subject property is being launched as a <span class="summary-bold">New Listing (0 CDOM)</span>, providing a crucial opportunity to establish immediate high velocity. This launch must be perfectly priced and incentivized to achieve the 120-day target.
                        </p>
                        <p>
                            The average closed velocity for similar homes in the $300k-$400k range is <span class="summary-bold">74 days</span>. The price anchor of $375,000 places the listing well above the average closed PPSF, meaning the listing is relying heavily on the **Solar, Foundation, and Roof** upgrades to justify the premium.
                        </p>
                        <ul class="list-disc list-outside pl-6 space-y-2">
                            <li><span class="font-semibold text-gray-900">Immediate Risk:</span> If the $375,000 price is not accepted by Day 40, the listing will begin to stagnate and must immediately proceed to the next scheduled price reduction to avoid crossing the 74-day average.</li>
                            <li><span class="font-semibold text-gray-900">Strategy Mandate:</span> The new 120-day plan is the required mechanism to move the property from its ambitious starting price down to the market-validated floor of **$349,900**, ensuring a sale within the mandate.</li>
                        </ul>
                        <div class="bg-yellow-50 border-l-4 border-yellow-600 p-4 rounded-r-lg">
                           <p class="font-extrabold text-yellow-800">
                               The $375,000 anchor price requires an extended 120-day reduction strategy to successfully liquidate the property without a major price concession outside of the plan.
                           </p>
                        </div>
                    </div>
                    
                    <div class="chart-container mt-10">
                        <canvas id="cdomComparisonChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- 7. CAMPAIGN STRATEGY PAGE - Executive Media Suite -->
            <div id="tab-campaign" class="py-8 md:py-12 hidden">
                <h2 class="text-2xl font-semibold text-gray-700 text-center mb-10">Executive Media Suite</h2>
                <div class="max-w-6xl mx-auto px-6 sm:px-8">
                    <!-- Strategic Narrative Box -->
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-600 rounded-lg p-6 mb-8 shadow-md">
                        <h3 class="text-lg font-bold text-gray-800 mb-2">Strategic Narrative</h3>
                        <p class="text-gray-700 leading-relaxed">
                            Visual verification of the property's modernization and immediate access to the Garland corridor establishes the baseline for our Phase 1 pricing strategy.
                        </p>
                    </div>
                    
                    <!-- 6-Pillar Dark Grid (3 columns) - Knox Gold Standard -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        <!-- Pillar 1: 3D Immersion -->
                        <div class="bg-slate-900 rounded-3xl p-6 shadow-2xl border border-slate-700 transition-all duration-300 hover:scale-[1.03] flex flex-col">
                            <h3 class="text-xl font-bold text-white mb-3">üè† 3D Immersion</h3>
                            <p class="text-slate-300 mb-4 text-sm leading-relaxed">Interactive Matterport tour providing 360¬∞ property exploration from anywhere in the world.</p>
                            <div class="grid grid-cols-1 gap-3 mt-auto">
                                <a href="https://my.matterport.com/show/?m=cTSxrKFZQvR" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center w-full px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200">
                                    View 3D Tour
                                </a>
                            </div>
                        </div>
                        
                        <!-- Pillar 2: Aerial Intel -->
                        <div class="bg-slate-900 rounded-3xl p-6 shadow-2xl border border-slate-700 transition-all duration-300 hover:scale-[1.03] flex flex-col">
                            <h3 class="text-xl font-bold text-white mb-3">üöÅ Aerial Intel</h3>
                            <p class="text-slate-300 mb-4 text-sm leading-relaxed">Professional drone photography showcasing property context, lot size, and neighborhood positioning.</p>
                            
                            <div class="grid grid-cols-1 gap-3 mt-auto">
                                <a href="https://youtu.be/zvhdvlnRB1U" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center w-full px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200">
                                    View Drone Video
                                </a>
                                <button type="button" onclick="openCarousel('drone')" class="inline-flex items-center justify-center w-full px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200">
                                    View Drone HDR
                                </button>
                            </div>
                        </div>
                        
                        <!-- Pillar 3: HDR Mastery -->
                        <div class="bg-slate-900 rounded-3xl p-6 shadow-2xl border border-slate-700 transition-all duration-300 hover:scale-[1.03] flex flex-col">
                            <h3 class="text-xl font-bold text-white mb-3">üì∏ HDR Mastery</h3>
                            <p class="text-slate-300 mb-4 text-sm leading-relaxed">High Dynamic Range photography highlighting architectural details and premium finishes.</p>
                            
                            <div class="grid grid-cols-1 gap-3 mt-auto">
                                <button type="button" onclick="openCarousel('hdr')" class="inline-flex items-center justify-center w-full px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200">
                                    View HDR Gallery
                                </button>
                                <button type="button" onclick="openCarousel('virtual')" class="inline-flex items-center justify-center w-full px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200">
                                    Virtual Staging
                                </button>
                            </div>
                        </div>
                        
                        <!-- Pillar 4: Video Marketing -->
                        <div class="bg-slate-900 rounded-3xl p-6 shadow-2xl border border-slate-700 transition-all duration-300 hover:scale-[1.03] flex flex-col">
                            <h3 class="text-xl font-bold text-white mb-3">üé¨ Video Marketing</h3>
                            <p class="text-slate-300 mb-4 text-sm leading-relaxed">Professional video compilation showcasing property features and neighborhood context.</p>
                            <div class="grid grid-cols-1 gap-3 mt-auto">
                                <a href="https://youtu.be/fj_mo819gi0" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center w-full px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200">
                                    View TGR Compilation
                                </a>
                                <a href="https://youtu.be/91lSqOvc2m4" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center w-full px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200">
                                    View YouTube Short
                                </a>
                            </div>
                        </div>
                        
                        <!-- Pillar 5: Distribution Network -->
                        <div class="bg-slate-900 rounded-3xl p-6 shadow-2xl border border-slate-700 transition-all duration-300 hover:scale-[1.03] flex flex-col">
                            <h3 class="text-xl font-bold text-white mb-3">üåê Distribution Network</h3>
                            <p class="text-slate-300 mb-4 text-sm leading-relaxed">Multi-platform distribution across MLS, Zillow, Realtor.com, and premium real estate networks.</p>
                            <div class="grid grid-cols-1 gap-3 mt-auto">
                                <button onclick="openSyndicationModal()" class="inline-flex items-center justify-center w-full px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200">
                                    View Syndication Reach
                                </button>
                            </div>
                        </div>
                        
                        <!-- Pillar 6: Social Acceleration -->
                        <div class="bg-slate-900 rounded-3xl p-6 shadow-2xl border border-slate-700 transition-all duration-300 hover:scale-[1.03] flex flex-col">
                            <h3 class="text-xl font-bold text-white mb-3">üöÄ Social Acceleration</h3>
                            <p class="text-slate-300 mb-4 text-sm leading-relaxed">Social media marketing and engagement across Facebook, Instagram, and LinkedIn platforms.</p>
                            <div class="grid grid-cols-1 gap-3 mt-auto">
                                <a href="https://www.facebook.com/TexasGrandRealty/videos/717407894216647/" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center w-full px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200">
                                    View Facebook Reel
                                </a>
                                <a href="https://www.instagram.com/reels/DLyCyyEtMF8/" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center w-full px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200">
                                    View Instagram Reel
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 8. DOCUMENTS PAGE - Secure Asset Repository -->
            <div id="tab-documents" class="py-8 md:py-12 hidden">
                <div class="max-w-6xl mx-auto px-6 sm:px-8">
                    <!-- Header with Blue Glowing Circle -->
                    <div class="text-center mb-10">
                        <div class="inline-flex items-center justify-center w-20 h-20 bg-blue-600 rounded-full shadow-lg shadow-blue-500/50 mb-4">
                            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                        </div>
                        <h2 class="text-3xl font-bold text-gray-800">Secure Asset Repository</h2>
                        <p class="text-gray-600 mt-2">All property documentation and legal disclosures</p>
                    </div>
                    
                    <!-- 7-Card Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Card 1: Listing Agreement -->
                        <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-200 hover:shadow-xl transition-shadow duration-300">
                            <div class="flex items-center justify-center w-12 h-12 bg-blue-100 rounded-lg mb-4">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                            </div>
                            <h3 class="text-lg font-bold text-gray-800 mb-2">Listing Agreement</h3>
                            <p class="text-gray-600 text-sm mb-4">Exclusive right to sell agreement and terms.</p>
                            <button class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors">
                                View Document
                            </button>
                        </div>
                        
                        <!-- Card 2: IABS -->
                        <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-200 hover:shadow-xl transition-shadow duration-300">
                            <div class="flex items-center justify-center w-12 h-12 bg-green-100 rounded-lg mb-4">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                            <h3 class="text-lg font-bold text-gray-800 mb-2">IABS</h3>
                            <p class="text-gray-600 text-sm mb-4">Information About Brokerage Services disclosure.</p>
                            <button class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors">
                                View Document
                            </button>
                        </div>
                        
                        <!-- Card 3: Seller Disclosure -->
                        <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-200 hover:shadow-xl transition-shadow duration-300">
                            <div class="flex items-center justify-center w-12 h-12 bg-purple-100 rounded-lg mb-4">
                                <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                            <h3 class="text-lg font-bold text-gray-800 mb-2">Seller Disclosure</h3>
                            <p class="text-gray-600 text-sm mb-4">Property condition and known defects disclosure.</p>
                            <button class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors">
                                View Document
                            </button>
                        </div>
                        
                        <!-- Card 4: LBP (Lead-Based Paint) -->
                        <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-200 hover:shadow-xl transition-shadow duration-300">
                            <div class="flex items-center justify-center w-12 h-12 bg-yellow-100 rounded-lg mb-4">
                                <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                                </svg>
                            </div>
                            <h3 class="text-lg font-bold text-gray-800 mb-2">LBP</h3>
                            <p class="text-gray-600 text-sm mb-4">Lead-Based Paint disclosure (if applicable).</p>
                            <button disabled class="w-full px-4 py-2 bg-gray-300 text-gray-500 font-medium rounded-lg cursor-not-allowed">
                                N/A
                            </button>
                        </div>
                        
                        <!-- Card 5: HOA -->
                        <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-200 hover:shadow-xl transition-shadow duration-300">
                            <div class="flex items-center justify-center w-12 h-12 bg-indigo-100 rounded-lg mb-4">
                                <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                                </svg>
                            </div>
                            <h3 class="text-lg font-bold text-gray-800 mb-2">HOA</h3>
                            <p class="text-gray-600 text-sm mb-4">Homeowners Association documents and bylaws.</p>
                            <button class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors">
                                View Document
                            </button>
                        </div>
                        
                        <!-- Card 6: Financing -->
                        <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-200 hover:shadow-xl transition-shadow duration-300">
                            <div class="flex items-center justify-center w-12 h-12 bg-red-100 rounded-lg mb-4">
                                <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                            <h3 class="text-lg font-bold text-gray-800 mb-2">Financing</h3>
                            <p class="text-gray-600 text-sm mb-4">Financing options and loan documentation.</p>
                            <button class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors">
                                View Document
                            </button>
                        </div>
                        
                        <!-- Card 7: Sewer -->
                        <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-200 hover:shadow-xl transition-shadow duration-300">
                            <div class="flex items-center justify-center w-12 h-12 bg-teal-100 rounded-lg mb-4">
                                <svg class="w-6 h-6 text-teal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                                </svg>
                            </div>
                            <h3 class="text-lg font-bold text-gray-800 mb-2">Sewer</h3>
                            <p class="text-gray-600 text-sm mb-4">Sewer line inspection and documentation.</p>
                            <button class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors">
                                View Document
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 9. COMPARATIVE OPTIONS (SUMMARY) -->
            <div id="tab-options" class="py-8 md:py-12 hidden">
                <h2 class="text-2xl font-semibold text-gray-700 text-center mb-10">Comparative Options (Summary)</h2>
                <p class="text-gray-500 text-center max-w-3xl mx-auto mb-8">The table below compares the buyer impact and seller cost for the three primary strategies. The goal is to choose the option that best drives liquidity in a complex market.</p>

                <div class="page-section mx-6 sm:mx-8 overflow-x-auto">
                    <table class="w-full text-left text-sm text-gray-600 data-table">
                        <thead class="bg-blue-100 text-blue-800">
                            <tr>
                                <th class="p-3">Strategy</th>
                                <th class="p-3">Buyer Benefit/Incentive</th>
                                <th class="p-3">Seller Cost/Loss</th>
                                <th class="p-3">Purchase Price Anchor</th>
                                <th class="p-3">Starting Monthly P&I*</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-blue-200">
                            <!-- Option 1: Price Reduction -->
                            <tr class="hover:bg-gray-50">
                                <td class="p-3 font-extrabold text-blue-700">Option 1: 120-Day Price Strategy</td>
                                <td class="p-3">Permanent $25,100 Price Reduction</td>
                                <td class="p-3 font-extrabold text-red-600">Loss of Net Proceeds: ~$25,100</td>
                                <td class="p-3">$349,900 (Price Floor)</td>
                                <td class="p-3" id="option1-summary-payment"></td>
                            </tr>
                            <!-- Option 2: 3-2-1 Buydown -->
                            <tr class="hover:bg-gray-50">
                                <td class="p-3 font-extrabold text-blue-700">Option 2: 3-2-1 Rate Buydown</td>
                                <td class="p-3">Temporarily lowers IR to 3.625% (Yr 1)</td>
                                <td class="p-3 font-extrabold text-red-600">Upfront Cost: $20,057.81</td>
                                <td class="p-3">$375,000</td>
                                <td class="p-3" id="option2-summary-payment"></td>
                            </tr>
                            <!-- Option 3: Owner Finance -->
                            <tr class="hover:bg-gray-50">
                                <td class="p-3 font-extrabold text-blue-700">Option 3: Owner Finance</td>
                                <td class="p-3">Guaranteed, Low-DP Financing</td>
                                <td class="p-3">Loss of Liquidity, 7-Year Risk</td>
                                <td class="p-3">$375,000</td>
                                <td class="p-3" id="option3-summary-payment"></td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="5" class="p-3 text-xs text-gray-500">*Calculations assume a 20% down payment (except Option 3, which assumes 10%) and 30-year amortization.</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
            
            <!-- 8. 90-DAY PRICE STRATEGY (OPTION 1) -->
            <div id="tab-option1" class="py-8 md:py-12 hidden">
                <h2 class="text-2xl font-semibold text-gray-700 text-center mb-10">Option 1: 120-Day Price Reduction Strategy</h2>
                <div class="page-section max-w-4xl mx-auto space-y-6">
                    <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500 mb-6">
                        <h3 class="text-xl font-extrabold text-blue-800">Goal: Achieve Price Floor of $349,900 Within 120 Days</h3>
                        <p class="text-blue-700 mt-2">This 6-step strategy systematically corrects the $\$375,000$ starting price to the validated market floor, overriding the negative perception of the 103 CDOM.</p>
                    </div>

                    <h3 class="text-xl font-semibold text-gray-700 mb-4">Pricing Schedule:</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm text-gray-600 data-table">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="p-3">Schedule</th>
                                    <th class="p-3">Action</th>
                                    <th class="p-3">Price</th>
                                    <th class="p-3">Reduction Amount</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y">
                                <tr>
                                    <td class="p-3 font-extrabold text-blue-700">Day 0 (Immediate)</td>
                                    <td class="p-3">Initial Strategic Price</td>
                                    <td class="p-3 font-extrabold">$375,000</td>
                                    <td class="p-3">$0</td>
                                </tr>
                                <tr>
                                    <td class="p-3 font-extrabold text-blue-700">Day 20</td>
                                    <td class="p-3">Aggressive Cut 1</td>
                                    <td class="p-3 font-extrabold">$369,900</td>
                                    <td class="p-3">$5,100</td>
                                </tr>
                                <tr>
                                    <td class="p-3 font-extrabold text-blue-700">Day 40</td>
                                    <td class="p-3">Aggressive Cut 2</td>
                                    <td class="p-3 font-extrabold">$364,900</td>
                                    <td class="p-3">$5,000</td>
                                </tr>
                                <tr>
                                    <td class="p-3 font-extrabold text-blue-700">Day 60</td>
                                    <td class="p-3">Aggressive Cut 3</td>
                                    <td class="p-3 font-extrabold">$359,900</td>
                                    <td class="p-3">$5,000</td>
                                </tr>
                                <tr>
                                    <td class="p-3 font-extrabold text-blue-700">Day 100</td>
                                    <td class="p-3">Final Push Cut 4</td>
                                    <td class="p-3 font-extrabold">$352,400</td>
                                    <td class="p-3">$7,500</td>
                                </tr>
                                <tr>
                                    <td class="p-3 font-extrabold text-red-600">Day 120 (Price Floor)</td>
                                    <td class="p-3">Definitive Price Anchor</td>
                                    <td class="p-3 font-extrabold">$349,900</td>
                                    <td class="p-3">$2,500</td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="4" class="p-3 text-xs font-extrabold text-gray-700 text-right">Total Reduction from Anchor: $25,100 (6.7% Drop)</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    
                    <h3 class="text-xl font-semibold text-gray-700 pt-4 mb-4">Buyer Financial Impact (At Price Floor)</h3>
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <ul class="space-y-2 text-gray-700">
                            <li class="flex justify-between items-center"><span class="font-medium">Price Floor:</span> <span class="font-extrabold">$349,900</span></li>
                            <li class="flex justify-between items-center"><span class="font-medium">Assumed Down Payment (20%):</span> $69,980</li>
                            <li class="flex justify-between items-center"><span class="font-medium">Loan Principal:</span> $279,920</li>
                            <li class="flex justify-between items-center"><span class="font-medium">Market Rate (6.45%):</span> <span class="font-extrabold text-blue-700">6.45%</span></li>
                            <li class="flex justify-between items-center"><span class="font-medium">Monthly P&I Payment:</span> <span class="text-lg font-extrabold text-blue-700" id="option1-payment"></span></li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 9. 3-2-1 BUYDOWN DETAILS (OPTION 2) -->
            <div id="tab-option2" class="py-8 md:py-12 hidden">
                <h2 class="text-2xl font-semibold text-gray-700 text-center mb-10">Option 2: 3-2-1 Rate Buydown Details</h2>
                <div class="page-section max-w-4xl mx-auto space-y-6">
                    <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-500 mb-6">
                        <h3 class="text-xl font-extrabold text-green-800">Goal: Maximum Affordability with Preserved Price</h3>
                        <p class="text-green-700 mt-2">This strategy uses the seller's <span class="font-extrabold">$20,058</span> contribution to lower the buyer's payment dramatically during the first three years, preserving the sale price while offering the lowest initial monthly payment.</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-gray-100 p-4 rounded-lg shadow-inner">
                            <h4 class="font-extrabold text-gray-800 mb-2">Seller Financial Details</h4>
                            <ul class="space-y-2 text-gray-700">
                                <li class="flex justify-between items-center"><span class="font-medium">Purchase Price Anchor:</span> <span class="font-extrabold">$375,000</span></li>
                                <li class="flex justify-between items-center"><span class="font-medium">Total Seller Contribution:</span> <span class="font-extrabold text-red-600" id="option2-cost"></span></li>
                            </ul>
                        </div>
                        <div class="bg-gray-100 p-4 rounded-lg shadow-inner">
                            <h4 class="font-extrabold text-gray-800 mb-2">Buyer Loan Terms</h4>
                            <ul class="space-y-2 text-gray-700">
                                <li class="flex justify-between items-center"><span class="font-medium">Assumed Down Payment (20%):</span> $75,000</li>
                                <li class="flex justify-between items-center"><span class="font-medium">Loan Principal:</span> $300,000</li>
                                <li class="flex justify-between items-center"><span class="font-medium">Fully Indexed Rate (Yrs 4-30):</span> <span class="font-extrabold text-blue-700">6.45%</span></li>
                            </ul>
                        </div>
                    </div>
                    
                    <h3 class="text-xl font-semibold text-gray-700 pt-4 mb-4">Buyer Monthly Payment Schedule</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm text-gray-600 data-table">
                            <thead class="bg-green-100 text-green-800">
                                <tr>
                                    <th class="p-3 min-w-[100px]">Period</th>
                                    <th class="p-3 min-w-[120px]">Interest Rate (IR)</th>
                                    <th class="p-3 min-w-[180px]">Monthly P&I Payment</th>
                                    <th class="p-3 min-w-[200px]">Savings vs. Fully Indexed</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-green-200">
                                <tr>
                                    <td class="p-3 font-extrabold text-green-700">Year 1</td>
                                    <td class="p-3 font-extrabold text-green-600">3.625%</td>
                                    <td class="p-3 font-extrabold text-green-600" id="option2-yr1-payment"></td>
                                    <td class="p-3 font-extrabold text-green-600" id="option2-yr1-savings"></td>
                                </tr>
                                <tr>
                                    <td class="p-3 font-extrabold text-green-700">Year 2</td>
                                    <td class="p-3">4.625%</td>
                                    <td class="p-3" id="option2-yr2-payment"></td>
                                    <td class="p-3" id="option2-yr2-savings"></td>
                                </tr>
                                <tr>
                                    <td class="p-3 font-extrabold text-green-700">Year 3</td>
                                    <td class="p-3">5.625%</td>
                                    <td class="p-3" id="option2-yr3-payment"></td>
                                    <td class="p-3" id="option2-yr3-savings"></td>
                                </tr>
                                <tr>
                                    <td class="p-3 font-extrabold text-red-600">Years 4-30</td>
                                    <td class="p-3 font-extrabold text-red-600">6.45% (Fully Indexed)</td>
                                    <td class="p-3 font-extrabold text-red-600" id="option2-yr4-payment"></td>
                                    <td class="p-3">N/A</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- NEW IMAGE SECTION -->
                    <h3 class="text-xl font-semibold text-gray-700 pt-4 mb-4">Supporting Visuals: 3-2-1 Buydown Costs</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <a href="buydown_cost_sheet_1.png" target="_blank" class="block hover:opacity-90 transition-opacity">
                            <img src="buydown_cost_sheet_1.png" alt="3-2-1 Rate Buydown Cost Sheet" class="w-full h-auto rounded-lg shadow-md border border-gray-200 cursor-pointer">
                        </a>
                        <a href="buydown_cost_sheet_2.png" target="_blank" class="block hover:opacity-90 transition-opacity">
                            <img src="buydown_cost_sheet_2.png" alt="6.625 Percent Rate Buydown Cost Sheet" class="w-full h-auto rounded-lg shadow-md border border-gray-200 cursor-pointer">
                        </a>
                    </div>
                    <!-- END IMAGE SECTION -->
                </div>
            </div>

            <!-- 10. OWNER FINANCE DETAILS (OPTION 3) -->
            <div id="tab-option3" class="py-8 md:py-12 hidden">
                <h2 class="text-2xl font-semibold text-gray-700 text-center mb-10">Option 3: Owner Finance Details</h2>
                <div class="page-section max-w-4xl mx-auto space-y-6">
                    <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500 mb-6">
                        <h3 class="text-xl font-extrabold text-blue-800">Goal: Access to Non-Conventional Buyers & Increased Seller Revenue</h3>
                        <p class="text-blue-700 mt-2">This strategy targets buyers who cannot secure conventional financing, while providing the seller with significant interest income and a large balloon payment in <span class="font-extrabold">7</span> years.</p>
                    </div>

                    <div class="bg-red-50 p-4 rounded-lg border-l-4 border-red-500 mb-6">
                        <h4 class="font-extrabold text-red-800">Seller Financial Summary (7 Year Term)</h4>
                        <ul class="space-y-2 text-red-700 mt-2">
                            <li class="flex justify-between items-center"><span class="font-medium">Total Revenue (Principal + Interest):</span> <span id="total-revenue-value" class="font-extrabold text-xl"></span></li>
                            <li class="flex justify-between items-center"><span class="font-medium">Total Interest/Premium Earned:</span> <span id="interest-earned-value" class="font-extrabold text-xl"></span></li>
                            <li class="flex justify-between items-center"><span class="font-medium">Seller Premium Over List Price ($375,000):</span> <span class="font-extrabold text-xl" id="seller-premium-value"></span></li>
                            <li class="flex justify-between items-center border-t-2 border-red-300 pt-2"><span class="font-medium">Total Revenue After Balloon Payment:</span> <span id="total-revenue-after-balloon-value" class="font-extrabold text-xl text-red-900"></span></li>
                        </ul>
                    </div>

                    <h3 class="text-xl font-semibold text-gray-700 mb-4">Owner Finance Terms & Amortization Summary</h3>
                    <div class="bg-gray-100 p-4 rounded-lg mb-6">
                        <ul class="space-y-2 text-gray-700">
                            <li class="flex justify-between items-center"><span class="font-medium">List Price Anchor:</span> <span class="font-extrabold">$375,000</span></li>
                            <li class="flex justify-between items-center"><span class="font-medium">Minimum Down Payment (10%):</span> <span id="owner-finance-dp"></span></li>
                            <li class="flex justify-between items-center"><span class="font-medium">Loan Principal:</span> <span id="owner-finance-principal"></span></li>
                            <li class="flex justify-between items-center"><span class="font-medium">Interest Rate (Fixed):</span> <span class="font-extrabold text-red-600">6.75%</span></li>
                            <li class="flex justify-between items-center"><span class="font-medium">Amortization Period:</span> 30 Years</li>
                            <li class="flex justify-between items-center"><span class="font-medium">Balloon Due:</span> <span class="font-extrabold text-red-600">7 Years (Month 84)</span></li>
                            <li class="flex justify-between items-center"><span class="font-medium">Monthly P&I Payment:</span> <span class="text-lg font-extrabold text-red-600" id="owner-finance-payment"></span></li>
                        </ul>
                    </div>
                    
                    <h4 class="font-bold text-gray-700 mb-2">Amortization Milestones:</h4>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm text-gray-600 min-w-max">
                            <thead class="text-xs text-white uppercase bg-blue-700">
                                <tr>
                                    <th class="p-3">Month</th>
                                    <th class="p-3">Starting Balance</th>
                                    <th class="p-3">Payment</th>
                                    <th class="p-3">Interest Paid</th>
                                    <th class="p-3">Principal Paid</th>
                                    <th class="p-3">Ending Balance</th>
                                </tr>
                            </thead>
                            <tbody id="owner-finance-schedule" class="divide-y">
                                <!-- Data populated by JS -->
                            </tbody>
                            <tfoot class="bg-red-100">
                                <tr>
                                    <td class="p-3 font-extrabold text-red-800">84 (Balloon)</td>
                                    <td class="p-3 font-extrabold text-red-800" colspan="4">BALLOON PAYMENT REQUIRED</td>
                                    <td class="p-3 font-extrabold text-red-800" id="balloon-value"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    
                    <h4 class="font-bold text-gray-700 mb-2 mt-6">Complete Amortization Schedule (84 Months):</h4>
                    <div class="overflow-x-auto max-h-[600px] overflow-y-auto border border-gray-300 rounded-lg">
                        <table class="w-full text-left text-xs text-gray-600 min-w-max">
                            <thead class="text-xs text-white uppercase bg-blue-700 sticky top-0">
                                <tr>
                                    <th class="p-2">Month</th>
                                    <th class="p-2">Starting Balance</th>
                                    <th class="p-2">Payment</th>
                                    <th class="p-2">Interest Paid</th>
                                    <th class="p-2">Principal Paid</th>
                                    <th class="p-2">Ending Balance</th>
                                </tr>
                            </thead>
                            <tbody id="owner-finance-complete-schedule" class="divide-y divide-gray-200">
                                <!-- Data populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- 11. PRICING ROADMAP PAGE -->
            <div id="tab-roadmap" class="py-8 md:py-12 hidden">
                <h2 class="text-2xl font-semibold text-gray-700 text-center mb-10">Pricing Roadmap: Strategic Phases</h2>
                <div class="page-section max-w-4xl mx-auto space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="roadmap-phases">
                        <!-- Phases populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- 12. FINANCIAL ANALYSIS PAGE -->
            <div id="tab-financial" class="py-8 md:py-12 hidden">
                <h2 class="text-2xl font-semibold text-gray-700 text-center mb-10">Financial Analysis Summary</h2>
                <div class="page-section max-w-4xl mx-auto space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-blue-50 p-6 rounded-lg border-l-4 border-blue-500">
                            <h3 class="text-lg font-bold text-blue-800 mb-4">Property Fundamentals</h3>
                            <ul class="space-y-2 text-gray-700">
                                <li class="flex justify-between"><span class="font-medium">List Price:</span> <span id="financial-price" class="font-bold"></span></li>
                                <li class="flex justify-between"><span class="font-medium">Square Footage:</span> <span id="financial-sqft" class="font-bold"></span></li>
                                <li class="flex justify-between"><span class="font-medium">Price per SqFt:</span> <span id="financial-ppsf" class="font-bold"></span></li>
                                <li class="flex justify-between"><span class="font-medium">Year Built:</span> <span id="financial-year" class="font-bold"></span></li>
                            </ul>
                        </div>
                        <div class="bg-green-50 p-6 rounded-lg border-l-4 border-green-500">
                            <h3 class="text-lg font-bold text-green-800 mb-4">Market Position</h3>
                            <ul class="space-y-2 text-gray-700">
                                <li class="flex justify-between"><span class="font-medium">CDOM:</span> <span id="financial-cdom" class="font-bold"></span></li>
                                <li class="flex justify-between"><span class="font-medium">Price Floor:</span> <span id="financial-floor" class="font-bold"></span></li>
                                <li class="flex justify-between"><span class="font-medium">Market Rate:</span> <span id="financial-rate" class="font-bold"></span></li>
                                <li class="flex justify-between"><span class="font-medium">Total Reduction:</span> <span id="financial-reduction" class="font-bold text-red-600"></span></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
        </main>
        
        <footer class="text-center py-8 mt-12 border-t border-gray-200">
            <p class="text-sm text-gray-500">Confidential Residential Market Analysis | Garland, TX | Generated: November 2025</p>
        </footer>

    </div>

    <!-- Syndication Modal -->
    <div id="syndicationModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between rounded-t-2xl">
                <div>
                    <h3 class="text-2xl font-bold text-gray-800">Global Distribution Network</h3>
                    <p class="text-sm text-gray-600 mt-1">900+ Publisher Partners | Verified Reach</p>
                </div>
                <button onclick="closeSyndicationModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <h4 class="font-bold text-blue-800 mb-2">MLS Networks</h4>
                        <ul class="text-sm text-gray-700 space-y-1">
                            <li>‚Ä¢ NTREIS (North Texas Real Estate Information Systems)</li>
                            <li>‚Ä¢ Real Estate Board of Greater Fort Worth</li>
                            <li>‚Ä¢ MetroTex Association of REALTORS¬Æ</li>
                        </ul>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                        <h4 class="font-bold text-green-800 mb-2">Consumer Portals</h4>
                        <ul class="text-sm text-gray-700 space-y-1">
                            <li>‚Ä¢ Zillow</li>
                            <li>‚Ä¢ Realtor.com</li>
                            <li>‚Ä¢ Trulia</li>
                            <li>‚Ä¢ Redfin</li>
                        </ul>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                        <h4 class="font-bold text-purple-800 mb-2">Premium Networks</h4>
                        <ul class="text-sm text-gray-700 space-y-1">
                            <li>‚Ä¢ Luxury Portfolio International</li>
                            <li>‚Ä¢ Leading Real Estate Companies of the World</li>
                            <li>‚Ä¢ Realty.com</li>
                        </ul>
                    </div>
                    <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                        <h4 class="font-bold text-orange-800 mb-2">Social Media</h4>
                        <ul class="text-sm text-gray-700 space-y-1">
                            <li>‚Ä¢ Facebook Marketplace</li>
                            <li>‚Ä¢ Instagram Business</li>
                            <li>‚Ä¢ LinkedIn Professional Network</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Extended Global Affiliate Network Section -->
                <div class="bg-slate-900 rounded-2xl p-8 mb-6 text-center">
                    <h4 class="text-xl font-bold text-white mb-3">Extended Global Affiliate Network</h4>
                    <a href="https://drive.google.com/file/d/189BtmEuch1UB4SRdgwMEcqM3XfEf9LtK/view?usp=sharing" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200">
                        Download Full 100+ Affiliate List
                    </a>
                </div>
                
                <div class="bg-blue-900 border-l-8 border-blue-400 text-white p-6 rounded-2xl">
                    <p class="text-sm font-bold text-white">
                        <span class="relative inline-flex h-3 w-3 mr-2">
                            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-3 w-3 bg-blue-500"></span>
                        </span>
                        <strong>Total Reach:</strong> This property is syndicated across <span class="text-blue-400 font-black">900+ total platforms</span>, ensuring maximum visibility to qualified buyers in the Garland market and beyond.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Master Gallery Engine Lightbox -->
    <div id="imageLightbox" class="fixed inset-0 bg-black/95 backdrop-blur-2xl z-[100] hidden flex flex-col items-center justify-center">
        <button onclick="closeLightbox()" class="absolute top-6 right-6 text-white/70 hover:text-white z-[110]">
            <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
        
        <div class="relative w-full h-full flex items-center justify-center px-4">
            <button onclick="prevImage()" class="absolute left-4 p-4 text-white/50 hover:text-white transition-colors">
                <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
            </button>
            
            <img id="carouselMainImage" src="" class="max-w-full max-h-[85vh] object-contain shadow-2xl rounded-lg border border-white/10" alt="Property view">
            
            <button onclick="nextImage()" class="absolute right-4 p-4 text-white/50 hover:text-white transition-colors">
                <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </button>
        </div>
        
        <div id="carouselCounter" class="absolute bottom-8 text-white/70 font-medium tracking-widest bg-white/10 px-4 py-2 rounded-full backdrop-blur-md">
            1 / 25
        </div>
    </div>

    <script>
        // --- PROPERTY DATA OBJECT (2026 Dashboard Standard) ---
        const propertyData = {
            address: '3433 Morning Star Ln, Garland, TX 75043',
            price: 375000,
            sqft: 2004,
            yearBuilt: '1984 (Resale)',
            roadmapPhases: [
                { phase: 1, price: 375000, label: 'Phase 1' },
                { phase: 2, price: 364900, label: 'Phase 2' },
                { phase: 3, price: 349900, label: 'Phase 3' }
            ],
            matterportLink: 'https://my.matterport.com/show/?m=cTSxrKFZQvR',
            matterportEmbedUrl: 'https://my.matterport.com/show/?m=cTSxrKFZQvR&play=1&mls=2',
            cdom: 0,
            downPaymentPct: 0.20,
            marketRate: 0.0645,
            priceFloor: 349900,
            ownerFinanceRate: 0.0675,
            ownerFinanceDownPct: 0.10
        };

        // --- DERIVED CONSTANTS FROM propertyData ---
        const SUBJECT_PRICE = propertyData.price;
        const SUBJECT_SQFT = propertyData.sqft;
        const SUBJECT_DP_PCT = propertyData.downPaymentPct;
        const MARKET_RATE = propertyData.marketRate;
        const PRICE_FLOOR_OPTION_1 = propertyData.priceFloor;
        const BUYDOWN_PRICE_OPTION_2 = propertyData.price;
        const OWNER_FINANCE_RATE = propertyData.ownerFinanceRate;
        const OWNER_FINANCE_DP_PCT = propertyData.ownerFinanceDownPct;
        const TOTAL_CDOM = propertyData.cdom;

        // Pricing strategy constants
        const BUYDOWNS = {
            // 3-2-1 Buydown Rates and Costs 
            RATES: [0.03625, 0.04625, 0.05625, 0.0645], // Final validated rates
            SELLER_COST: 20057.81, // $8,302.00 + $5,684.58 + $2,913.13 + $3,158.10
            PRICE_ANCHOR: BUYDOWN_PRICE_OPTION_2,
        };

        // Pricing schedule for chart data (PPSF is calculated during chart init)
        const pricingStrategy = [
            { label: 'Start Price ($186.29/SqFt)', price: 375000, day: 0 },
            { label: 'Day 20 Reduction ($183.20/SqFt)', price: 369900, day: 20 },
            { label: 'Day 40 Reduction ($180.77/SqFt)', price: 364900, day: 40 },
            { label: 'Day 60 Reduction ($178.29/SqFt)', price: 359900, day: 60 },
            { label: 'Day 100 Reduction ($175.81/SqFt)', price: 352400, day: 100 },
            { label: 'Day 120 Floor ($174.60/SqFt)', price: 349900, day: 120 },
        ];

        const compData = {
            // DATA SET 1: Neighborhood Proximity (Garland Area)
            ds1: {
                active: [
                    { mls: '21028128', address: '1410 Surrey CT', city: 'Garland', sqft: 2013, yb: 1971, acres: 0.340, ppsf: 163.88, listPrice: 329900, cdom: 103, isSubject: false },
                    { mls: '20984480', address: '1310 Briar Hollow LN', city: 'Garland', sqft: 2155, yb: 1971, acres: 0.260, ppsf: 157.77, listPrice: 340000, cdom: 142 },
                    { mls: '21054767', address: '1214 Merrimac TRL', city: 'Garland', sqft: 2000, yb: 1971, acres: 0.234, ppsf: 179.50, listPrice: 359000, cdom: 71 },
                    // Subject Property
                    { mls: 'SUBJECT', address: '3433 Morning Star Ln', city: 'Garland', sqft: 2004, yb: 1984, acres: 0.340, ppsf: 186.29, listPrice: 375000, cdom: 0, isSubject: true },
                ],
                pending: [
                    { mls: '20934922', address: '1305 Willow WAY', city: 'Garland', sqft: 2102, yb: 1975, acres: 0.234, ppsf: 161.27, listPrice: 339000, cdom: 150, status: 'PENDING' },
                ],
                closed: [
                    { mls: '20946015', address: '4909 Berkeley CT', city: 'Garland', sqft: 2360, yb: 1989, soldPrice: 344900, soldDate: '08/29/2025', slRatio: 100.0, cdom: 74, ppsf: 146.14 },
                    { mls: '21033627', address: '1401 Surrey CT', city: 'Garland', sqft: 2491, yb: 1972, soldPrice: 350000, soldDate: '11/07/2025', slRatio: 100.0, cdom: 46, ppsf: 140.51 },
                    { mls: '20953092', address: '1902 Wiggs WAY', city: 'Garland', sqft: 2566, yb: 1972, soldPrice: 365000, soldDate: '11/07/2025', slRatio: 100.0, cdom: 158, ppsf: 142.24 },
                ],
            },
            // DATA SET 2: AVM via RPR in NTREIS
            ds2: {
                active: [
                    { mls: 'SUBJECT', address: '3433 Morning Star Ln', city: 'Garland', sqft: 2004, yb: 1984, acres: 0.340, ppsf: 171, listPrice: 343480, cdom: 0, isSubject: true }, 
                    { mls: 'AVM_A', address: '1410 Surrey Ct', city: 'Garland', sqft: 2013, yb: 1971, acres: 0.340, ppsf: 166.37, listPrice: 334900, cdom: 103, isSubject: false },
                ],
                pendingClosed: [ 
                    { status: 'CLOSED', mls: 'AVM_1', address: '3438 Morning Star Ln', city: 'Garland', sqft: 2159, yb: 1977, soldPrice: 320000, soldDate: '06/12/2025', slRatio: 90.0, cdom: 27, ppsf: 148 },
                    { status: 'CLOSED', mls: 'AVM_2', address: '3318 Sunrise Dr', city: 'Garland', sqft: 2031, yb: 1984, soldPrice: 389500, soldDate: '08/27/2025', slRatio: 100.0, cdom: 33, ppsf: 192 },
                    { status: 'CLOSED', mls: 'AVM_3', address: '3321 Bluffview Dr', city: 'Garland', sqft: 2500, yb: 1978, soldPrice: 370000, soldDate: '11/11/2025', slRatio: 95.0, cdom: 79, ppsf: 148 },
                    { status: 'CLOSED', mls: 'AVM_4', address: '3418 Hightrail Ln', city: 'Garland', sqft: 2213, yb: 1981, soldPrice: 385000, soldDate: '03/24/25', slRatio: 95.0, cdom: 33, ppsf: 174 },
                    { status: 'CLOSED', mls: 'AVM_5', address: '3325 Bluffview Dr', city: 'Garland', sqft: 2500, yb: 1978, soldPrice: 425000, soldDate: '04/08/25', slRatio: 95.0, cdom: 54, ppsf: 170 },
                ],
            },
            // DATA SET 3: Direct Price Competition ($300,000 to $400,000)
            ds3: {
                active: [
                    { mls: '21095955', address: '4030 Random CIR', city: 'Garland', sqft: 1857, yb: 1972, acres: 0.213, ppsf: 166.94, listPrice: 310000, cdom: 23 },
                    { mls: '21117110', address: '725 Middle Glen DR', city: 'Garland', sqft: 1738, yb: 1977, acres: 0.195, ppsf: 183.54, listPrice: 319000, cdom: 1 },
                    { mls: '21015393', address: '1610 Iroquois DR', city: 'Garland', sqft: 2426, yb: 1966, acres: 0.293, ppsf: 131.90, listPrice: 320000, cdom: 116 },
                    { mls: '21077244', address: '4006 Cedar Creek', city: 'Garland', sqft: 1694, yb: 1976, acres: 0.179, ppsf: 193.57, listPrice: 327900, cdom: 49 },
                    { mls: '21028128', address: '1410 Surrey CT', city: 'Garland', sqft: 2013, yb: 1971, acres: 0.340, ppsf: 163.88, listPrice: 329900, cdom: 103, isSubject: false },
                    { mls: '20993209', address: '4102 Cedar Creek DR', city: 'Garland', sqft: 2271, yb: 1978, acres: 0.180, ppsf: 145.31, listPrice: 330000, cdom: 136 },
                    { mls: '20983199', address: '1706 Iroquois DR', city: 'Garland', sqft: 2538, yb: 1968, acres: 0.307, ppsf: 135.93, listPrice: 345000, cdom: 147 },
                    { mls: '21117223', address: '1510 Palm Valley DR', city: 'Garland', sqft: 2319, yb: 1983, acres: 0.274, ppsf: 150.93, listPrice: 350000, cdom: 1 },
                    { mls: 'SUBJECT', address: '3433 Morning Star Ln', city: 'Garland', sqft: 2004, yb: 1984, acres: 0.340, ppsf: 186.29, listPrice: 375000, cdom: 0, isSubject: true },
                ],
                pendingClosed: [
                    { status: 'PENDING', mls: '20934922', address: '1305 Willow WAY', city: 'Garland', sqft: 2102, yb: 1975, soldPrice: 339000, soldDate: 'N/A', slRatio: 'N/A', cdom: 150, ppsf: 161.27 },
                    { status: 'CLOSED', mls: '20829125', address: '3909 Larkin LN', city: 'Garland', sqft: 3555, yb: 1999, soldPrice: 300000, soldDate: '06/11/2025', slRatio: 88.7, cdom: 99, ppsf: 84.39 },
                    { status: 'CLOSED', mls: '20910414', address: '237 Trailridge DR', city: 'Garland', sqft: 1537, yb: 1971, soldPrice: 300000, soldDate: '07/03/2025', slRatio: 96.8, cdom: 49, ppsf: 195.19 },
                    { status: 'CLOSED', mls: '20965574', address: '5221 Sarasota DR', city: 'Garland', sqft: 2001, yb: 1974, soldPrice: 300000, soldDate: '08/18/2025', slRatio: 87.0, cdom: 49, ppsf: 149.93 },
                    { status: 'CLOSED', mls: '20995742', address: '3510 Syracuse DR', city: 'Garland', sqft: 2307, yb: 1975, soldPrice: 300000, soldDate: '11/13/2025', slRatio: 100.0, cdom: 111, ppsf: 130.04 },
                    { status: 'CLOSED', mls: '21039409', address: '4210 Mayflower DR', city: 'Garland', sqft: 1997, yb: 1973, soldPrice: 300000, soldDate: '10/14/2025', slRatio: 95.2, cdom: 25, ppsf: 150.23 },
                    { status: 'CLOSED', mls: '21034251', address: '1625 Blackhawk LN', city: 'Garland', sqft: 1754, yb: 1956, soldPrice: 305000, soldDate: '09/16/2025', slRatio: 101.8, cdom: 1, ppsf: 173.89 },
                    { status: 'CLOSED', mls: '20984464', address: '1310 David DR', city: 'Garland', sqft: 1807, yb: 1986, soldPrice: 314500, soldDate: '08/05/2025', slRatio: 101.5, cdom: 3, ppsf: 174.05 },
                    { status: 'CLOSED', mls: '20884818', address: '710 Colonial DR', city: 'Garland', sqft: 1935, yb: 1968, soldPrice: 314900, soldDate: '07/22/2025', slRatio: 100.0, cdom: 91, ppsf: 162.74 },
                    { status: 'CLOSED', mls: '20895891', address: '4906 Portola DR', city: 'Garland', sqft: 2052, yb: 1986, soldPrice: 315000, soldDate: '05/29/2025', slRatio: 100.0, cdom: 8, ppsf: 153.51 },
                    { status: 'CLOSED', mls: '20880233', address: '1206 Mayapple DR', city: 'Garland', sqft: 1831, yb: 1978, soldPrice: 319000, soldDate: '08/15/2025', slRatio: 100.0, cdom: 100, ppsf: 174.22 },
                    { status: 'CLOSED', mls: '21099405', address: '4301 Rosehill RD', city: 'Garland', sqft: 1512, yb: 1960, soldPrice: 320000, soldDate: '11/04/2025', slRatio: 97.0, cdom: 4, ppsf: 211.64 },
                    { status: 'CLOSED', mls: '20784668', address: '4933 Avalon DR', city: 'Garland', sqft: 1635, yb: 1976, soldPrice: 324000, soldDate: '06/09/2025', slRatio: 103.2, cdom: 50, ppsf: 198.17 },
                    { status: 'CLOSED', mls: '20697256', address: '4821 Worthing DR', city: 'Garland', sqft: 1982, yb: 1993, soldPrice: 325000, soldDate: '06/25/2025', slRatio: 100.0, cdom: 296, ppsf: 163.98 },
                    { status: 'CLOSED', mls: '20914227', address: '718 Angle Ridge CIR', city: 'Garland', sqft: 1890, yb: 1975, soldPrice: 325000, soldDate: '08/21/2025', slRatio: 98.8, cdom: 88, ppsf: 171.96 },
                    { status: 'CLOSED', mls: '20934688', address: '1111 Lupine DR', city: 'Garland', sqft: 2027, yb: 1978, soldPrice: 325000, soldDate: '07/09/2025', slRatio: 100.0, cdom: 11, ppsf: 160.34 },
                    { status: 'CLOSED', mls: '20973032', address: '4005 Azalea LN', city: 'Garland', sqft: 1858, yb: 1977, soldPrice: 325000, soldDate: '08/29/2025', slRatio: 100.0, cdom: 24, ppsf: 174.92 },
                    { status: 'CLOSED', mls: '20988836', address: '3816 Roan CIR', city: 'Garland', sqft: 1877, yb: 1976, soldPrice: 326000, soldDate: '08/21/2025', slRatio: 100.0, cdom: 2, ppsf: 173.68 },
                    { status: 'CLOSED', mls: '21042599', address: '4022 Azalea LN', city: 'Garland', sqft: 1668, yb: 1981, soldPrice: 330000, soldDate: '10/31/2025', slRatio: 97.1, cdom: 34, ppsf: 197.84 },
                    { status: 'CLOSED', mls: '21029010', address: '3001 Jeremes LNDG', city: 'Garland', sqft: 2142, yb: 1985, soldPrice: 339900, soldDate: '09/16/2025', slRatio: 100.0, cdom: 9, ppsf: 158.68 },
                    { status: 'CLOSED', mls: '20946015', address: '4909 Berkeley CT', city: 'Garland', sqft: 2360, yb: 1989, soldPrice: 344900, soldDate: '08/29/2025', slRatio: 100.0, cdom: 74, ppsf: 146.14 },
                    { status: 'CLOSED', mls: '20946685', address: '1429 Knob Hill DR', city: 'Garland', sqft: 1667, yb: 1985, soldPrice: 345000, soldDate: '07/23/2025', slRatio: 95.8, cdom: 11, ppsf: 206.96 },
                    { status: 'CLOSED', mls: '21023759', address: '1902 Merrimac TRL', city: 'Garland', sqft: 2253, yb: 1984, soldPrice: 350010, soldDate: '10/10/2025', slRatio: 100.0, cdom: 15, ppsf: 155.35 },
                    { status: 'CLOSED', mls: '20967291', address: '5214 Graham DR', city: 'Garland', sqft: 1886, yb: 2001, soldPrice: 355000, soldDate: '07/11/2025', slRatio: 98.6, cdom: 6, ppsf: 188.23 },
                    { status: 'CLOSED', mls: '20970990', address: '209 Havenwood LN', city: 'Garland', sqft: 1875, yb: 2002, soldPrice: 360000, soldDate: '08/04/2025', slRatio: 94.7, cdom: 90, ppsf: 192.00 },
                    { status: 'CLOSED', mls: '20880605', address: '1221 Pecan Valley DR', city: 'Garland', sqft: 2350, yb: 1972, soldPrice: 367500, soldDate: '07/15/2025', slRatio: 91.9, cdom: 84, ppsf: 156.38 },
                    { status: 'CLOSED', mls: '21041035', address: '3321 Bluffview DR', city: 'Garland', sqft: 2500, yb: 1978, soldPrice: 370000, soldDate: '11/11/2025', slRatio: 94.9, cdom: 40, ppsf: 148.00 },
                    { status: 'CLOSED', mls: '20879659', address: '1717 Lake Bluff DR', city: 'Garland', sqft: 2649, yb: 1999, soldPrice: 372500, soldDate: '06/23/2025', slRatio: 96.0, cdom: 48, ppsf: 140.62 },
                    { status: 'CLOSED', mls: '21011459', address: '1605 James Good LN', city: 'Garland', sqft: 2483, yb: 1978, soldPrice: 375000, soldDate: '08/29/2025', slRatio: 100.0, cdom: 10, ppsf: 151.03 },
                    { status: 'CLOSED', mls: '20773714', address: '1410 Pine Hill DR', city: 'Garland', sqft: 2751, yb: 1975, soldPrice: 376500, soldDate: '06/18/2025', slRatio: 97.8, cdom: 150, ppsf: 136.86 },
                    { status: 'CLOSED', mls: '21041956', address: '1514 Dakota DR', city: 'Garland', sqft: 2410, yb: 1969, soldPrice: 380000, soldDate: '10/03/2025', slRatio: 100.0, cdom: 15, ppsf: 157.68 },
                    { status: 'CLOSED', mls: '21051343', address: '918 Myers Meadow DR', city: 'Garland', sqft: 2299, yb: 2012, soldPrice: 380000, soldDate: '10/31/2025', slRatio: 97.7, cdom: 205, ppsf: 165.29 },
                    { status: 'CLOSED', mls: '20857278', address: '8414 Slowburn DR', city: 'Garland', sqft: 1935, yb: 2025, soldPrice: 383585, soldDate: '05/28/2025', slRatio: 95.0, cdom: 17, ppsf: 198.24 },
                    { status: 'CLOSED', mls: '20954539', address: '4521 Park Meadow CT', city: 'Garland', sqft: 2155, yb: 1997, soldPrice: 385000, soldDate: '06/27/2025', slRatio: 100.0, cdom: 7, ppsf: 178.65 },
                    { status: 'CLOSED', mls: '21030173', address: '2809 Apple Valley DR', city: 'Garland', sqft: 2589, yb: 1982, soldPrice: 385710, soldDate: '11/12/2025', slRatio: 102.9, cdom: 53, ppsf: 148.98 },
                    { status: 'CLOSED', mls: '21009914', address: '7293 Farmhouse DR', city: 'Garland', sqft: 1712, yb: 2025, soldPrice: 386085, soldDate: '09/26/2025', slRatio: 97.1, cdom: 33, ppsf: 225.52 },
                    { status: 'CLOSED', mls: '21018005', address: '7322 Farmhouse DR', city: 'Garland', sqft: 1712, yb: 2025, soldPrice: 386085, soldDate: '08/28/2025', slRatio: 98.5, cdom: 4, ppsf: 225.52 },
                    { status: 'CLOSED', mls: '21046799', address: '1302 Lakebreeze DR', city: 'Garland', sqft: 3065, yb: 2001, soldPrice: 387000, soldDate: '10/30/2025', slRatio: 96.8, cdom: 21, ppsf: 126.26 },
                    { status: 'CLOSED', mls: '20884905', address: '7326 Farmhouse DR', city: 'Garland', sqft: 1935, yb: 2025, soldPrice: 388585, soldDate: '06/25/2025', slRatio: 97.5, cdom: 15, ppsf: 200.82 },
                    { status: 'CLOSED', mls: '21016103', address: '4405 Fairlake DR', city: 'Garland', sqft: 2199, yb: 1998, soldPrice: 389000, soldDate: '09/09/2025', slRatio: 100.0, cdom: 2, ppsf: 176.90 },
                    { status: 'CLOSED', mls: '20707645', address: '213 Hockaday AVE', city: 'Garland', sqft: 2500, yb: 1974, soldPrice: 390000, soldDate: '06/10/2025', slRatio: 101.3, cdom: 271, ppsf: 156.00 },
                ],
            },
        };

        // --- CHART DATA PREPARATION ---

        const allClosedPpsf = compData.ds3.pendingClosed.filter(c => c.status === 'CLOSED').map(c => c.ppsf);
        const avgClosedPpsf = allClosedPpsf.reduce((sum, p) => sum + p, 0) / allClosedPpsf.length;
        const subjectPpsf = 186.29; 

        // --- UTILITY FUNCTIONS (Defined globally in this single file) ---

        const currencyFormat = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 });
        const currencyFormatDetailed = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2, maximumFractionDigits: 2 });
        const numberFormat = new Intl.NumberFormat('en-US');

        function roundCurrency(value) {
            return Math.round(value * 100) / 100;
        }

        function calculateMonthlyPayment(principal, annualRate, termsYears) {
            const rate = annualRate / 12;
            const n = termsYears * 12;
            if (rate === 0) return roundCurrency(principal / n);
            const payment = principal * (rate * Math.pow(1 + rate, n)) / (Math.pow(1 + rate, n) - 1);
            return roundCurrency(payment);
        }

        function calculateRemainingBalance(principal, annualRate, monthlyPayment, paymentsMade) {
            const r = annualRate / 12;
            const balance = principal * Math.pow(1 + r, paymentsMade) - monthlyPayment * (Math.pow(1 + r, paymentsMade) - 1) / r;
            return roundCurrency(balance);
        }

        // --- CALCULATE ALL OPTION PAYMENTS AND VALUES (with proper rounding) ---
        
        // Option 1: Price Strategy
        const option1Principal = roundCurrency(PRICE_FLOOR_OPTION_1 * (1 - SUBJECT_DP_PCT));
        const option1Payment = calculateMonthlyPayment(option1Principal, MARKET_RATE, 30);

        // Option 2: 3-2-1 Buydown
        const option2Principal = roundCurrency(BUYDOWN_PRICE_OPTION_2 * (1 - SUBJECT_DP_PCT));
        const option2PaymentYear1 = calculateMonthlyPayment(option2Principal, BUYDOWNS.RATES[0], 30);
        const option2PaymentYear2 = calculateMonthlyPayment(option2Principal, BUYDOWNS.RATES[1], 30);
        const option2PaymentYear3 = calculateMonthlyPayment(option2Principal, BUYDOWNS.RATES[2], 30);
        const option2PaymentYear4 = calculateMonthlyPayment(option2Principal, BUYDOWNS.RATES[3], 30);

        // Option 3: Owner Finance (calculated from amortization schedule)
        const option3DownPayment = roundCurrency(SUBJECT_PRICE * OWNER_FINANCE_DP_PCT);
        const option3Principal = roundCurrency(SUBJECT_PRICE - option3DownPayment);
        const option3Payment = calculateMonthlyPayment(option3Principal, OWNER_FINANCE_RATE, 30);
        
        // Calculate Option 3 totals from the amortization schedule
        let option3RemainingBalance = 0;
        let option3TotalRevenue = 0;
        let option3InterestEarned = 0;
        let option3TotalRevenueAfterBalloon = 0;
        
        function calculateOption3Totals() {
            try {
                // Ensure we have the required values
                if (!option3Payment || option3Payment === 0) {
                    console.error('option3Payment is not calculated yet');
                    return;
                }
                
                if (!option3Principal || option3Principal === 0) {
                    console.error('option3Principal is not calculated yet');
                    return;
                }
                
                // Try to get values from amortization schedule first
                const scheduleData = calculateAmortizationSchedule();
                const schedule = scheduleData.schedule;
                
                if (schedule && Array.isArray(schedule) && schedule.length > 0) {
                    // Get the balloon payment (month 84) entry
                    const balloonEntry = schedule.find(entry => entry && entry.month === 84);
                    if (balloonEntry) {
                        // Remaining balance (balloon payment due at month 84)
                        option3RemainingBalance = roundCurrency(balloonEntry.endingBalance || 0);
                        
                        // Total Interest/Premium Earned = Cumulative interest paid over 84 months
                        option3InterestEarned = roundCurrency(balloonEntry.interestPaid || 0);
                        
                        // Total Revenue = Total payments received over 84 months
                        // This equals: Principal Paid + Interest Paid = Monthly Payment √ó 84
                        option3TotalRevenue = roundCurrency((balloonEntry.principalPaid || 0) + (balloonEntry.interestPaid || 0));
                        
                        // Verify calculation: Total Revenue should equal monthly payment √ó 84
                        const verificationTotal = roundCurrency(option3Payment * 84);
                        if (Math.abs(option3TotalRevenue - verificationTotal) > 0.01) {
                            console.warn('Total revenue calculation mismatch. Using verified value.');
                            option3TotalRevenue = verificationTotal;
                        }
                        
                        // Verify interest earned calculation
                        if (option3InterestEarned === 0 || isNaN(option3InterestEarned)) {
                            // Recalculate interest earned
                            option3InterestEarned = roundCurrency(option3TotalRevenue - (balloonEntry.principalPaid || 0));
                        }
                        
                        // Total Revenue After Balloon = Total Revenue (from payments) + Balloon Payment
                        option3TotalRevenueAfterBalloon = roundCurrency(option3TotalRevenue + option3RemainingBalance);
                        
                        return; // Successfully calculated from schedule
                    }
                }
                
                // Fallback: Calculate using standard formulas
                console.log('Using fallback calculations for Option 3 totals');
                option3RemainingBalance = roundCurrency(calculateRemainingBalance(option3Principal, OWNER_FINANCE_RATE, option3Payment, 84));
                
                // Total payments received = Monthly Payment √ó 84 months
                const totalPayments = roundCurrency(option3Payment * 84);
                
                // Principal paid = Original Principal - Remaining Balance
                const principalPaid = roundCurrency(option3Principal - option3RemainingBalance);
                
                // Interest earned = Total Payments - Principal Paid
                option3InterestEarned = roundCurrency(totalPayments - principalPaid);
                
                // Total Revenue = Total Payments Received
                option3TotalRevenue = totalPayments;
                
                // Total Revenue After Balloon = Total Revenue (from payments) + Balloon Payment
                option3TotalRevenueAfterBalloon = roundCurrency(option3TotalRevenue + option3RemainingBalance);
                
            } catch (error) {
                console.error('Error calculating Option 3 totals:', error);
                console.error('Error stack:', error.stack);
                
                // Final fallback: Use direct calculations
                try {
                    option3RemainingBalance = roundCurrency(calculateRemainingBalance(option3Principal, OWNER_FINANCE_RATE, option3Payment, 84));
                    const totalPayments = roundCurrency(option3Payment * 84);
                    const principalPaid = roundCurrency(option3Principal - option3RemainingBalance);
                    option3InterestEarned = roundCurrency(totalPayments - principalPaid);
                    option3TotalRevenue = totalPayments;
                    
                    // Total Revenue After Balloon = Total Revenue (from payments) + Balloon Payment
                    option3TotalRevenueAfterBalloon = roundCurrency(option3TotalRevenue + option3RemainingBalance);
                } catch (fallbackError) {
                    console.error('Fallback calculation also failed:', fallbackError);
                    // Set to zero to prevent undefined values
                    option3RemainingBalance = 0;
                    option3InterestEarned = 0;
                    option3TotalRevenue = 0;
                    option3TotalRevenueAfterBalloon = 0;
                }
            }
        }


        // --- SYNDICATION MODAL FUNCTIONS ---
        function openSyndicationModal() {
            const modal = document.getElementById('syndicationModal');
            if (modal) {
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
            }
        }
        
        function closeSyndicationModal() {
            const modal = document.getElementById('syndicationModal');
            if (modal) {
                modal.classList.add('hidden');
                document.body.style.overflow = ''; // Restore scrolling
            }
        }
        
        // Close modal when clicking outside
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('syndicationModal');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeSyndicationModal();
                    }
                });
            }
            
            // Close lightbox when clicking outside
            const lightbox = document.getElementById('imageLightbox');
            if (lightbox) {
                lightbox.addEventListener('click', function(e) {
                    if (e.target === lightbox) {
                        closeLightbox();
                    }
                });
            }
            
            // Keyboard support for Master Gallery Engine
            document.addEventListener('keydown', function(e) {
                const lightboxEl = document.getElementById('imageLightbox');
                const visible = lightboxEl && !lightboxEl.classList.contains('hidden');

                if (!visible) return;

                if (e.key === 'Escape') {
                    closeLightbox();
                } else if (e.key === 'ArrowRight') {
                    nextImage();
                } else if (e.key === 'ArrowLeft') {
                    prevImage();
                }
            });
        });
        
        // --- MASTER GALLERY ENGINE (Carousel) ---
        let currentImages = [];
        let currentIndex = 0;

        function openCarousel(type) {
            let sourceArray = [];
            if (type === 'drone') {
                sourceArray = droneIds;
            } else if (type === 'hdr') {
                sourceArray = hdrIds;
            } else if (type === 'virtual') {
                sourceArray = virtualIds;
            } else {
                console.warn('Unknown carousel type:', type);
                return;
            }

            if (!sourceArray || sourceArray.length === 0) {
                console.warn('No images available for carousel type:', type);
                return;
            }

            // Shuffle on each open so the experience is fresh every time
            currentImages = shuffleArray(sourceArray);
            currentIndex = 0;

            const lightbox = document.getElementById('imageLightbox');
            if (!lightbox) return;

            updateCarousel();
            lightbox.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeLightbox() {
            const lightbox = document.getElementById('imageLightbox');
            if (lightbox) {
                lightbox.classList.add('hidden');
                document.body.style.overflow = '';
            }
            currentImages = [];
            currentIndex = 0;
        }

        function updateCarousel() {
            const imgEl = document.getElementById('carouselMainImage');
            const counterEl = document.getElementById('carouselCounter');
            if (!imgEl || !counterEl || !currentImages.length) return;

            const total = currentImages.length;
            const imageId = currentImages[currentIndex];
            const src = getGoogleDriveImageUrl(imageId);

            imgEl.src = src;
            counterEl.textContent = `${currentIndex + 1} / ${total}`;
        }

        function nextImage() {
            if (!currentImages.length) return;
            currentIndex = (currentIndex + 1) % currentImages.length;
            updateCarousel();
        }

        function prevImage() {
            if (!currentImages.length) return;
            currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length;
            updateCarousel();
        }
        
        // --- GOOGLE DRIVE IMAGE ID ARRAYS (Actual IDs) ---
        const droneIds = [
            '1ktkE5HeaVna9Yr1ADoki-e8uMjjHbdTw','19i0vdDYEeIrz-O8jHJqt7pkAuFbjiU--','1zlRqh1RW6C9tBhpEFLSUjUI2xjx8yFEs','1Rfmas63N5WlsE2NNbALGLcutHAKzjO56',
            '19ExwvWE2aymyEOZJ_j0JF144M6FHhzXY','1ZOot2JiOOZbVC6O3N2uYpJlQzH7SZJAw','13tblUO2EuaX1kJxb64MzefPqF35lp1WT','12DMvY7xUCKL-3fCuQPvOse8-Kckmwa4a',
            '1KenXrxBk-gkOM2HNrzLCKrIeMZiABCIs','1kPACw-aCsXjXI69NeIItTgfYUJEja_Hh','1OD4yBxJCazWIhFPILK79Hg4ch7UB7L9E','1Jslc1QhI9JKZasa0WQWkVMZC0Kj6pyhE',
            '1d73zdVIcgqVhtMDKHZzdaA-YbVSEaGSj','1YvoS7DJ7ZraKAR04S2nXGto-KSJvqgzD','1zn110Bjsemwg-8K5-JGr_vxTRkAvS9Sr','1KLvqdGA_CkIguMHMt05NjGdNjC0VP_14',
            '1n1G43l4dyJ6q7R_rsTE6o8-dwUb3hsV2','18g4dZ90xzdn8tBfOyotpT4o7zjSXKmMy','1F3gP4IudSCLR-Lb82uPztZ2CSrLnajKo','1_3OHXiBTMB5VfdFESwFvQ2AapiMgnzeO',
            '17njfYLIDzQ7Ej_C_4mFE89IYH2671v_y','1Z08S4ujd-OVpN4ATdnhafKjiD8hh8UHE','1sMmjExZ1x0JduMflNlLv1IhfqrbX3THE','1VF7KGgYq12KkNWUgU5b1M-kHprd7jrAT',
            '1sjSFeLPKRZHxkfksvFpl0y-gv46Dk-8_'
        ];
        
        const hdrIds = [
            '1_gpSI8O7C8vrqLZSRkDHyUXfh5CwDzKc','111CrFRaYPFQ6sgbsfVezt7IYiKua--in','1VZ8XXPNmOYYP2Sz8jskftGmriwcShZbF','1m0LL1y8DL6mUqFjwsyDlyEuiHiIhAHk',
            '1lFArAm14XvxoyyeE5RHjpFT0yHHBTVaI','11JLLscJ9Do1n4l545s3DhkWRVfDOEs-B','1mrtDyYZ9jO4ztJRqqvEL9k9Q8-BbKUZB','1NXhhpCZz5JH1ohPUeSp74nGx4ZAXcw5i',
            '1B1tCqZQrult1-5EXFYs6n36qnVcA_A8i','1aMJSD-jWRyvMPuQz_vRa-xjR-Rv55r1G','1ADFnfhmvTy_O61I-9WX27yPmjU5UCUMD','1Xwqdl8Mhla6zjswAKK8IpT14tPhyoXyx',
            '1GKkwf_M11cTCa7Qyz_ETtZuMKG2YKD3l','1zu19BAkuiz0QkkjLEBhceKGgtBTxu88I','1RJlJuC7IpAJdSrnflzXuGn9sKRhos7kP','1aAxUPS3kzXSBLhUH7kpHjlr8NWHi0Uyy',
            '1OA0xSZNCpFVijU14lEWRR5iczhSpgcwQ','16izSvZYtMRdV8YK-goslUHXrezHOGqYn','1OIz2yQ3F_u0Wq_rOgp7uYNiBnte2VAGg','1wrrkqlU9GP7uxhLEZtc98S5wOIzaYcOb',
            '165AhMJAbOr-65pJ3zOay413lrYQPqgos','1OriqtEG-yBMGA-RNyFxk2cdByyuCNetz','1JJ-otWlDZmqQhBcjfEwHU1oFZVVA45o-','1msiCeiqMzF1dRx9i4D1OSHM-2PLPZ_Sl',
            '1dTPRM6S-y6TT5lhP05Smmh4sLwDhKE3D','1jpG4vwRDN10QlQ6VWV2nOGfQGLu3YNVU'
        ];
        
        const virtualIds = [
            '1bb9lGZysJsxwUD_PDYRxlteak1FA0cUi','1iSiTmbiYrv0-ZykZM3q8341I3ROV_OdI','1OkRW3JcjLiDelWD7b731uN5PBqpyOFYT','19lZdJCf1U_uXUBB7c1sFm0-9_ulKBmFC',
            '1YXFFVpjUSmNYhh34xIfKomBpHFlubu7t','1smj4srBN7Csb9L1raLbEo_LDOmZlYDWx','1T8M8Bes2aitCWOa3e09-bk9QN9vo9NtC','1NZ34Ouc-OT77Q02ODizDxhjM034DlR0U',
            '16-gwlV2Uvsml6q7d1lZD64q-La-HdDu5','1h7CRKaz58uUlxrh-2QdT27-3Tl6R_iG6','1UAPubN58Q-3q4RFcVDCx1E9xuSrR5Cox','1sdYE0AG9f_IRMNj6fgkciUAf0ggm-ch9',
            '1TvOZsDMiPheCpBjBXj0dV6XD_e-Y3piJ','1N3J0kz1rJfSVvhdUKBXGXqcbohXGszdo'
        ];
        
        // --- FISHER-YATES SHUFFLE FUNCTION ---
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        
        // --- CONVERT GOOGLE DRIVE ID TO HIGH-PERFORMANCE CDN URL ---
        function getGoogleDriveImageUrl(fileId) {
            // Use Google CDN format for high-performance, resized 2048px images
            return `https://lh3.googleusercontent.com/u/0/d/${fileId}=w2048-h2048`;
        }
        
        // (Deprecated gallery grid helpers removed in favor of carousel-only system)

        function showTab(tabId) {
            if (!tabId) {
                console.error('showTab called without tabId');
                return;
            }
            
            try {
                // Hide all content tabs (support both tab- and page- for backward compatibility)
                const allTabs = document.querySelectorAll('main > div[id^="tab-"], main > div[id^="page-"]');
                allTabs.forEach(tab => tab.classList.add('hidden'));
                
                // Deactivate all nav buttons
                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
                
                // Show the target tab (try tab- first, then page- for backward compatibility)
                let tabElement = document.getElementById(`tab-${tabId}`);
                if (!tabElement) {
                    tabElement = document.getElementById(`page-${tabId}`);
                }
                if (tabElement) {
                    tabElement.classList.remove('hidden');
                } else {
                    console.error(`Tab element not found: tab-${tabId} or page-${tabId}`);
                }
                
                // Activate the corresponding button
                const navButton = document.getElementById(`nav-${tabId}`);
                if (navButton) {
                    navButton.classList.add('active');
                } else {
                    // Try alternative selector
                    const altButton = document.querySelector(`.nav-btn[data-page="${tabId}"]`);
                    if (altButton) {
                        altButton.classList.add('active');
                    } else {
                        console.warn(`Navigation button not found for tab: ${tabId}`);
                    }
                }

                // Default Comp Sub-tab on page load
                if (tabId === 'comps') {
                    showCompSubTab('neighborhood');
                }
                
                // Ensure amortization table and values are populated when Option 3 page is shown
                if (tabId === 'option3') {
                    // Small delay to ensure DOM is ready
                    setTimeout(() => {
                        // Recalculate totals to ensure they're current
                        calculateOption3Totals();
                        // Populate the Option 3 fields
                        populateOptions();
                        // Populate the amortization milestones table
                        populateAmortizationTable();
                        // Populate the complete amortization schedule
                        populateCompleteAmortizationTable();
                    }, 100);
                }
                
                // Re-initialize pricing chart when metrics page is shown
                if (tabId === 'metrics') {
                    setTimeout(() => {
                        initPricingChart();
                    }, 150);
                }
                
                // Scroll to top of page when switching tabs
                window.scrollTo({
                    top: 0,
                    left: 0,
                    behavior: 'smooth'
                });
                
            } catch (error) {
                console.error('Error in showTab:', error);
            }
        }

        function showCompSubTab(tabId) {
            // Sub-tab function 
            document.querySelectorAll('.sub-comp-content').forEach(div => div.classList.add('hidden'));
            document.querySelectorAll('.sub-nav-btn').forEach(btn => btn.classList.remove('active'));

            const targetContent = document.getElementById(`sub-page-${tabId}`);
            if (targetContent) targetContent.classList.remove('hidden');

            const navButton = document.querySelector(`.sub-nav-btn[data-comp="${tabId}"]`);
            if (navButton) navButton.classList.add('active');
        }


        // --- TABLE POPULATION ---

        function populateCompTable(data, type, tableId) {
            const tableBody = document.getElementById(tableId);
            if (!tableBody) return;
            
            tableBody.innerHTML = data.map(c => {
                const isSubject = c.isSubject;
                const cdomDisplay = c.cdom || 'N/A';
                const rowClass = isSubject ? 'bg-yellow-50 font-bold' : 'hover:bg-gray-50';
                const ppsfDisplay = c.ppsf ? c.ppsf.toFixed(2) : 'N/A';
                const cdomClass = (c.cdom > 100 && !isSubject) ? 'text-red-600' : 'text-stone-700';

                if (type === 'active') {
                    return `<tr class="${rowClass}">
                        <td class="p-3 font-medium text-gray-800">${c.mls || 'AVM'}</td>
                        <td class="p-3">${c.address}, ${c.city || 'Garland'}</td>
                        <td class="p-3">${numberFormat.format(c.sqft)}</td>
                        <td class="p-3">${c.yb || 'N/A'}</td>
                        <td class="p-3">${c.acres ? c.acres.toFixed(2) : 'N/A'}</td>
                        <td class="p-3">${ppsfDisplay}</td>
                        <td class="p-3">${currencyFormat.format(c.listPrice)}</td>
                        <td class="p-3 ${cdomClass}">${cdomDisplay}</td>
                    </tr>`;
                } else if (type === 'pending-closed') { 
                    const isClosed = c.status === 'CLOSED';
                    const statusClass = isClosed ? 'text-green-600' : 'text-orange-600';
                    return `<tr class="${rowClass}">
                        <td class="p-3 font-medium text-gray-800">${c.mls || 'AVM'} <span class="${statusClass}">(${c.status})</span></td>
                        <td class="p-3">${c.address}, ${c.city || 'Garland'}</td>
                        <td class="p-3">${numberFormat.format(c.sqft)}</td>
                        <td class="p-3">${c.yb}</td>
                        <td class="p-3">${currencyFormat.format(c.soldPrice)}</td>
                        <td class="p-3">${c.soldDate || 'N/A'}</td>
                        <td class="p-3">${c.slRatio ? c.slRatio.toFixed(1) + '%' : 'N/A'}</td>
                        <td class="p-3 ${cdomClass}">${cdomDisplay}</td>
                    </tr>`;
                }
                return '';
            }).join('');
        }

        function populateAllCompTables() {
            // DS1
            populateCompTable(compData.ds1.active, 'active', 'ds1-active-table');
            populateCompTable(compData.ds1.pending, 'active', 'ds1-pending-table');
            populateCompTable(compData.ds1.closed, 'pending-closed', 'ds1-closed-table');

            // DS2 (AVM)
            populateCompTable(compData.ds2.active, 'active', 'ds2-active-table');
            populateCompTable(compData.ds2.pendingClosed, 'pending-closed', 'ds2-closed-table');

            // DS3
            populateCompTable(compData.ds3.active, 'active', 'ds3-active-table');
            populateCompTable(compData.ds3.pendingClosed, 'pending-closed', 'ds3-pending-closed-table');
        }


        // --- FINANCIAL CALCULATIONS AND POPULATION ---

        function populateOptions() {
            // Option 1: Price Strategy Details
            document.getElementById('option1-payment').textContent = currencyFormatDetailed.format(option1Payment);
            document.getElementById('option1-summary-payment').textContent = currencyFormat.format(option1Payment);

            // Option 2: 3-2-1 Buydown Details
            const option2SavingsYr1 = roundCurrency(option2PaymentYear4 - option2PaymentYear1);
            const option2SavingsYr2 = roundCurrency(option2PaymentYear4 - option2PaymentYear2);
            const option2SavingsYr3 = roundCurrency(option2PaymentYear4 - option2PaymentYear3);


            document.getElementById('option2-yr1-payment').textContent = currencyFormatDetailed.format(option2PaymentYear1);
            document.getElementById('option2-yr1-savings').textContent = `Saves ${currencyFormatDetailed.format(option2SavingsYr1)}/mo`;
            document.getElementById('option2-yr2-payment').textContent = currencyFormatDetailed.format(option2PaymentYear2);
            document.getElementById('option2-yr2-savings').textContent = `Saves ${currencyFormatDetailed.format(option2SavingsYr2)}/mo`;
            document.getElementById('option2-yr3-payment').textContent = currencyFormatDetailed.format(option2PaymentYear3);
            document.getElementById('option2-yr3-savings').textContent = `Saves ${currencyFormatDetailed.format(option2SavingsYr3)}/mo`;
            document.getElementById('option2-yr4-payment').textContent = currencyFormatDetailed.format(option2PaymentYear4);
            document.getElementById('option2-cost').textContent = currencyFormat.format(BUYDOWNS.SELLER_COST);
            document.getElementById('option2-summary-payment').textContent = currencyFormat.format(option2PaymentYear1);


            // Option 3: Owner Finance Details
            // Ensure values are calculated before displaying
            if (typeof option3TotalRevenue === 'undefined' || option3TotalRevenue === 0) {
                calculateOption3Totals();
            }
            
            const totalRevenueEl = document.getElementById('total-revenue-value');
            const interestEarnedEl = document.getElementById('interest-earned-value');
            const sellerPremiumEl = document.getElementById('seller-premium-value');
            const balloonValueEl = document.getElementById('balloon-value');
            
            if (totalRevenueEl) {
                totalRevenueEl.textContent = currencyFormat.format(option3TotalRevenue || 0);
            } else {
                console.error('Element total-revenue-value not found');
            }
            
            if (interestEarnedEl) {
                interestEarnedEl.textContent = currencyFormat.format(option3InterestEarned || 0);
            } else {
                console.error('Element interest-earned-value not found');
            }
            
            if (sellerPremiumEl) {
                sellerPremiumEl.textContent = currencyFormat.format(option3InterestEarned || 0);
            } else {
                console.error('Element seller-premium-value not found');
            }
            
            if (balloonValueEl) {
                balloonValueEl.textContent = currencyFormat.format(option3RemainingBalance || 0);
            } else {
                console.error('Element balloon-value not found');
            }
            
            const totalRevenueAfterBalloonEl = document.getElementById('total-revenue-after-balloon-value');
            if (totalRevenueAfterBalloonEl) {
                totalRevenueAfterBalloonEl.textContent = currencyFormat.format(option3TotalRevenueAfterBalloon || 0);
            } else {
                console.error('Element total-revenue-after-balloon-value not found');
            }
            
            // Set other Option 3 fields
            const dpEl = document.getElementById('owner-finance-dp');
            const principalEl = document.getElementById('owner-finance-principal');
            const paymentEl = document.getElementById('owner-finance-payment');
            const summaryPaymentEl = document.getElementById('option3-summary-payment');
            
            if (dpEl) dpEl.textContent = currencyFormatDetailed.format(option3DownPayment);
            if (principalEl) principalEl.textContent = currencyFormatDetailed.format(option3Principal);
            if (paymentEl) paymentEl.textContent = currencyFormatDetailed.format(option3Payment);
            if (summaryPaymentEl) summaryPaymentEl.textContent = currencyFormat.format(option3Payment);
        }

        function calculateAmortizationSchedule() {
            // Option 3: Owner Financing (Fixed 6.75%)
            const P_owner = roundCurrency(375000 * (1 - 0.10)); // $337,500.00
            const rate_owner = 0.0675;  
            const M_owner = calculateMonthlyPayment(P_owner, rate_owner, 30); // Monthly payment for 30 years
            const balloonMonths_owner = 84; 
            const r_owner = rate_owner / 12;
            
            let schedule = [];
            const displayMonths = [1, 12, 24, 36, 60, balloonMonths_owner]; 

            let currentBalance = P_owner;
            let runningTotalInterest = 0;
            let runningTotalPrincipal = 0;

            for (let month = 1; month <= balloonMonths_owner; month++) {
                // Capture starting balance at the beginning of the month (rounded)
                const startingBalance = roundCurrency(currentBalance);
                
                // Calculate monthly interest payment (based on current balance)
                const monthlyInterest = roundCurrency(startingBalance * r_owner);
                
                // Calculate monthly principal payment (payment minus interest)
                const monthlyPrincipal = roundCurrency(M_owner - monthlyInterest);
                
                // Calculate ending balance (starting balance minus principal paid this month)
                const endingBalance = roundCurrency(startingBalance - monthlyPrincipal);
                
                // Update running totals (cumulative)
                runningTotalInterest = roundCurrency(runningTotalInterest + monthlyInterest);
                runningTotalPrincipal = roundCurrency(runningTotalPrincipal + monthlyPrincipal);
                
                // Update balance for next iteration
                currentBalance = endingBalance;
                
                // Store milestone data if this is a display month
                if (displayMonths.includes(month)) {
                    // Verify ending balance matches expected value (original principal - cumulative principal paid)
                    const expectedEndingBalance = roundCurrency(P_owner - runningTotalPrincipal);
                    
                    // Use the calculated ending balance (should match expected, but use calculated for accuracy)
                    const finalEndingBalance = roundCurrency(endingBalance);
                    
                    schedule.push({
                        month: month,
                        startingBalance: startingBalance,
                        payment: M_owner,
                        interestPaid: runningTotalInterest,  // Cumulative total interest paid
                        principalPaid: runningTotalPrincipal,  // Cumulative total principal paid
                        endingBalance: finalEndingBalance  // Remaining balance after this month
                    });
                }
            }
            
            return {
                schedule
            };
        }

        function populateAmortizationTable() {
            try {
                // Get the table body element
                const tableBody = document.getElementById('owner-finance-schedule');
                
                if (!tableBody) {
                    console.error('Table body element not found: owner-finance-schedule');
                    return;
                }
                
                // Calculate the amortization schedule
                const data = calculateAmortizationSchedule();
                
                if (!data || !data.schedule) {
                    console.error('Invalid schedule data returned from calculateAmortizationSchedule');
                    tableBody.innerHTML = '<tr><td colspan="6" class="p-3 text-center text-red-600">Error: Invalid schedule data</td></tr>';
                    return;
                }
                
                const schedule = data.schedule;
                
                if (!Array.isArray(schedule) || schedule.length === 0) {
                    console.error('Amortization schedule is empty or not an array. Length:', schedule ? schedule.length : 'null');
                    tableBody.innerHTML = '<tr><td colspan="6" class="p-3 text-center text-red-600">No schedule data available</td></tr>';
                    return;
                }
                
                // Build HTML rows for each milestone
                let html = '';
                
                schedule.forEach((item, index) => {
                    if (!item) {
                        console.warn(`Schedule item at index ${index} is null or undefined`);
                        return;
                    }
                    
                    // Extract and validate values
                    const month = item.month || 0;
                    const startingBalance = roundCurrency(item.startingBalance || 0);
                    const payment = roundCurrency(item.payment || 0);
                    const interestPaid = roundCurrency(item.interestPaid || 0);  // Cumulative interest paid
                    const principalPaid = roundCurrency(item.principalPaid || 0);  // Cumulative principal paid
                    const endingBalance = roundCurrency(item.endingBalance || 0);
                    
                    // Determine if this is the balloon payment month
                    const isBalloon = month === 84;
                    const rowClass = isBalloon ? 'bg-red-100 font-bold text-red-900 border-t-2 border-red-700' : 'text-gray-700';
                    const balloonText = isBalloon ? ' <span class="text-red-600">(BALLOON DUE)</span>' : '';
                    
                    // Build the table row HTML using template literals
                    html += `
                        <tr class="${rowClass}">
                            <td class="p-3">${month}${balloonText}</td>
                            <td class="p-3">${currencyFormatDetailed.format(startingBalance)}</td>
                            <td class="p-3">${currencyFormatDetailed.format(payment)}</td>
                            <td class="p-3">${currencyFormatDetailed.format(interestPaid)}</td>
                            <td class="p-3">${currencyFormatDetailed.format(principalPaid)}</td>
                            <td class="p-3 font-extrabold">${currencyFormatDetailed.format(endingBalance)}</td>
                        </tr>
                    `;
                });
                
                // Insert the HTML into the table body
                if (html === '') {
                    console.error('No HTML rows were generated from schedule');
                    tableBody.innerHTML = '<tr><td colspan="6" class="p-3 text-center text-red-600">No rows generated</td></tr>';
                } else {
                    tableBody.innerHTML = html;
                }
                
            } catch (error) {
                console.error('Error populating amortization table:', error);
                console.error('Error stack:', error.stack);
                const tableBody = document.getElementById('owner-finance-schedule');
                if (tableBody) {
                    tableBody.innerHTML = '<tr><td colspan="6" class="p-3 text-center text-red-600">Error loading schedule data: ' + error.message + '</td></tr>';
                }
            }
        }
        
        function calculateCompleteAmortizationSchedule() {
            // Option 3: Owner Financing (Fixed 6.75%)
            const P_owner = roundCurrency(375000 * (1 - 0.10)); // $337,500.00
            const rate_owner = 0.0675;  
            const M_owner = calculateMonthlyPayment(P_owner, rate_owner, 30); // Monthly payment for 30 years
            const balloonMonths_owner = 84; 
            const r_owner = rate_owner / 12;
            
            let schedule = [];
            let currentBalance = P_owner;

            for (let month = 1; month <= balloonMonths_owner; month++) {
                // Capture starting balance at the beginning of the month (rounded)
                const startingBalance = roundCurrency(currentBalance);
                
                // Calculate monthly interest payment (based on current balance)
                const monthlyInterest = roundCurrency(startingBalance * r_owner);
                
                // Calculate monthly principal payment (payment minus interest)
                const monthlyPrincipal = roundCurrency(M_owner - monthlyInterest);
                
                // Calculate ending balance (starting balance minus principal paid this month)
                const endingBalance = roundCurrency(startingBalance - monthlyPrincipal);
                
                // Update balance for next iteration
                currentBalance = endingBalance;
                
                // Store all months in the schedule
                schedule.push({
                    month: month,
                    startingBalance: startingBalance,
                    payment: M_owner,
                    interestPaid: monthlyInterest,  // Monthly interest (not cumulative)
                    principalPaid: monthlyPrincipal,  // Monthly principal (not cumulative)
                    endingBalance: endingBalance
                });
            }
            
            return schedule;
        }
        
        function populateCompleteAmortizationTable() {
            try {
                const schedule = calculateCompleteAmortizationSchedule();
                const tableBody = document.getElementById('owner-finance-complete-schedule');
                
                if (!tableBody) {
                    console.error('Table body element not found: owner-finance-complete-schedule');
                    return;
                }
                
                if (!schedule || schedule.length === 0) {
                    console.error('Complete amortization schedule is empty');
                    tableBody.innerHTML = '<tr><td colspan="6" class="p-2 text-center text-red-600">No schedule data available</td></tr>';
                    return;
                }
                
                let html = '';
                schedule.forEach((item, index) => {
                    if (!item) {
                        console.warn(`Schedule item at index ${index} is null or undefined`);
                        return;
                    }
                    
                    // Extract and validate values
                    const month = item.month || 0;
                    const startingBalance = roundCurrency(item.startingBalance || 0);
                    const payment = roundCurrency(item.payment || 0);
                    const interestPaid = roundCurrency(item.interestPaid || 0);  // Monthly interest
                    const principalPaid = roundCurrency(item.principalPaid || 0);  // Monthly principal
                    const endingBalance = roundCurrency(item.endingBalance || 0);
                    
                    // Determine if this is the balloon payment month
                    const isBalloon = month === 84;
                    const rowClass = isBalloon ? 'bg-red-100 font-bold text-red-900' : (month % 2 === 0 ? 'bg-gray-50' : 'bg-white');
                    const balloonText = isBalloon ? ' <span class="text-red-600">(BALLOON)</span>' : '';
                    
                    // Build the table row HTML
                    html += `
                        <tr class="${rowClass}">
                            <td class="p-2">${month}${balloonText}</td>
                            <td class="p-2">${currencyFormatDetailed.format(startingBalance)}</td>
                            <td class="p-2">${currencyFormatDetailed.format(payment)}</td>
                            <td class="p-2">${currencyFormatDetailed.format(interestPaid)}</td>
                            <td class="p-2">${currencyFormatDetailed.format(principalPaid)}</td>
                            <td class="p-2">${currencyFormatDetailed.format(endingBalance)}</td>
                        </tr>
                    `;
                });
                
                tableBody.innerHTML = html;
                
            } catch (error) {
                console.error('Error populating complete amortization table:', error);
                console.error('Error stack:', error.stack);
                const tableBody = document.getElementById('owner-finance-complete-schedule');
                if (tableBody) {
                    tableBody.innerHTML = '<tr><td colspan="6" class="p-2 text-center text-red-600">Error loading schedule data: ' + error.message + '</td></tr>';
                }
            }
        }


        // --- CHART INITIALIZATION (Simplified) ---
        
        // Store chart instances for potential re-initialization
        let pricingChartInstance = null;
        let cdomChartInstance = null;

        function initCharts() {
            try {
                // Chart 1: Pricing Strategy Trajectory (Key Pricing Metrics Tab)
                const pricingChartElement = document.getElementById('pricingStrategyChart');
                if (!pricingChartElement) {
                    console.error('pricingStrategyChart element not found');
                } else if (!pricingStrategy || !Array.isArray(pricingStrategy) || pricingStrategy.length === 0) {
                    console.error('pricingStrategy array is missing or empty');
                } else {
                    // Destroy existing chart if it exists
                    if (pricingChartInstance) {
                        pricingChartInstance.destroy();
                        pricingChartInstance = null;
                    }
                    
                    // Extract data from pricingStrategy array
                    const chartData = pricingStrategy.map(p => p.price);
                    const chartLabels = pricingStrategy.map(p => `Day ${p.day}`);
                    
                    pricingChartInstance = new Chart(pricingChartElement, {
                        type: 'line',
                        data: {
                            labels: chartLabels,
                            datasets: [{
                                label: 'List Price',
                                data: chartData,
                                borderColor: 'rgb(59, 130, 246)',
                                tension: 0.2,
                                fill: true,
                                pointBackgroundColor: 'rgb(29, 78, 216)'
                            }]
                        },
                        options: {
                            responsive: true, 
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            scales: {
                                y: { 
                                    beginAtZero: false, 
                                    ticks: { callback: (val) => currencyFormat.format(val) }, 
                                    min: 345000, 
                                    max: 380000 
                                },
                                x: { 
                                    title: { display: true, text: 'Action Day' }, 
                                    type: 'category' 
                                }
                            }
                        }
                    });
                }

                // Chart 2: CDOM Comparison (Liquidity Risk Tab)
                const cdomChartElement = document.getElementById('cdomComparisonChart');
                if (!cdomChartElement) {
                    console.error('cdomComparisonChart element not found');
                } else if (!compData || !compData.ds3 || !compData.ds3.pendingClosed) {
                    console.error('compData.ds3.pendingClosed is missing');
                } else {
                    // Filter closed comps from compData.ds3.pendingClosed
                    const closedComps = compData.ds3.pendingClosed.filter(c => c.status === 'CLOSED');
                    
                    if (!closedComps || closedComps.length === 0) {
                        console.error('No closed comps found in compData.ds3.pendingClosed');
                    } else {
                        // Build CDOM data array: Subject Property + Closed Comps
                        const cdomData = [
                            TOTAL_CDOM,
                            ...closedComps.map(c => c.cdom)
                        ];
                        
                        // Build labels array
                        const cdomLabels = [
                            `Subject Property (${TOTAL_CDOM} CDOM)`,
                            ...closedComps.map(c => `${c.address.split(' ')[0]} (${c.cdom} CDOM)`)
                        ];
                        
                        // Build background colors array (red for subject, blue for comps)
                        const backgroundColors = [
                            'rgb(220, 38, 38)', 
                            ...closedComps.map(() => 'rgb(59, 130, 246)')
                        ];

                        // Destroy existing chart if it exists
                        if (cdomChartInstance) {
                            cdomChartInstance.destroy();
                            cdomChartInstance = null;
                        }
                        
                        cdomChartInstance = new Chart(cdomChartElement, {
                            type: 'bar',
                            data: {
                                labels: cdomLabels.map(l => l.split(' (')[0]),
                                datasets: [{
                                    label: 'CDOM',
                                    data: cdomData,
                                    backgroundColor: backgroundColors,
                                }]
                            },
                            options: {
                                responsive: true, 
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: {
                                    y: { 
                                        beginAtZero: true, 
                                        title: { display: true, text: 'Cumulative Days on Market (CDOM)' } 
                                    },
                                    x: { 
                                        title: { display: true, text: 'Property (Red is Subject)' } 
                                    }
                                }
                            }
                        });
                    }
                }
            } catch (error) {
                console.error('Error initializing charts:', error);
                console.error('Error stack:', error.stack);
            }
        }
        
        // Function to initialize just the pricing strategy chart (for re-initialization when page is shown)
        function initPricingChart() {
            try {
                const pricingChartElement = document.getElementById('pricingStrategyChart');
                if (!pricingChartElement) {
                    console.error('pricingStrategyChart element not found');
                    return;
                }
                
                if (!pricingStrategy || !Array.isArray(pricingStrategy) || pricingStrategy.length === 0) {
                    console.error('pricingStrategy array is missing or empty');
                    return;
                }
                
                // Destroy existing chart if it exists
                if (pricingChartInstance) {
                    pricingChartInstance.destroy();
                    pricingChartInstance = null;
                }
                
                // Extract data from pricingStrategy array
                const chartData = pricingStrategy.map(p => p.price);
                const chartLabels = pricingStrategy.map(p => `Day ${p.day}`);
                
                // Small delay to ensure element is visible
                setTimeout(() => {
                    pricingChartInstance = new Chart(pricingChartElement, {
                        type: 'line',
                        data: {
                            labels: chartLabels,
                            datasets: [{
                                label: 'List Price',
                                data: chartData,
                                borderColor: 'rgb(59, 130, 246)',
                                tension: 0.2,
                                fill: true,
                                pointBackgroundColor: 'rgb(29, 78, 216)'
                            }]
                        },
                        options: {
                            responsive: true, 
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            scales: {
                                y: { 
                                    beginAtZero: false, 
                                    ticks: { callback: (val) => currencyFormat.format(val) }, 
                                    min: 345000, 
                                    max: 380000 
                                },
                                x: { 
                                    title: { display: true, text: 'Action Day' }, 
                                    type: 'category' 
                                }
                            }
                        }
                    });
                }, 100);
            } catch (error) {
                console.error('Error initializing pricing chart:', error);
            }
        }


        // --- EVENT LISTENERS AND INITIALIZATION (The Final Fix) ---
        function attachEventListeners() {
            // Attach event listener to all nav buttons (multiple selectors to ensure we catch them all)
            const navButtons = document.querySelectorAll('.nav-btn[data-page], #main-nav-container .nav-btn, nav .nav-btn');
            
            navButtons.forEach((button) => {
                // Create click handler function
                const clickHandler = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const targetTabId = this.getAttribute('data-page') || this.getAttribute('onclick')?.match(/showTab\('([^']+)'\)/)?.[1];
                    if (targetTabId) {
                        showTab(targetTabId);
                    }
                };
                
                // Add click event listener
                button.addEventListener('click', clickHandler);
                
                // Ensure button is clickable
                button.style.cursor = 'pointer';
                button.setAttribute('role', 'button');
                button.setAttribute('tabindex', '0');
                
                // Add keyboard support
                button.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        clickHandler.call(this, e);
                    }
                });
            });

            // Attach event listener to the main summary button
            const exploreButton = document.querySelector('[data-page-target="options"]');
            if (exploreButton) {
                 exploreButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    showTab(exploreButton.getAttribute('data-page-target'));
                });
                exploreButton.style.cursor = 'pointer';
            }

            // Attach event listener for sub-tab buttons
            const subTabButtons = document.querySelectorAll('#comp-nav-tabs .sub-nav-btn, .sub-nav-btn[data-comp]');
            subTabButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const compId = this.getAttribute('data-comp');
                    if (compId) {
                        showCompSubTab(compId);
                    }
                });
                button.style.cursor = 'pointer';
            });
        }


        // --- PROPERTY DATA POPULATION (2026 Dashboard Standard) ---
        function populatePropertyData() {
            // Update header address
            const headerAddress = document.getElementById('header-address');
            if (headerAddress) headerAddress.textContent = propertyData.address;
            
            // Update summary address
            const summaryAddress = document.getElementById('summary-address');
            if (summaryAddress) summaryAddress.textContent = propertyData.address;
            
            // Update summary price and floor
            const summaryPrice = document.getElementById('summary-price');
            if (summaryPrice) summaryPrice.textContent = currencyFormat.format(propertyData.price);
            
            const summaryFloor = document.getElementById('summary-floor');
            if (summaryFloor) summaryFloor.textContent = currencyFormat.format(propertyData.priceFloor);
            
            // Update Matterport link in Campaign Strategy tab
            const matterportLink = document.getElementById('matterport-link');
            if (matterportLink && propertyData.matterportLink) {
                matterportLink.href = propertyData.matterportLink;
            }
            
            // Update embedded Matterport viewer in Property tab
            const matterportEmbed = document.getElementById('matterport-embed');
            if (matterportEmbed && propertyData.matterportEmbedUrl) {
                matterportEmbed.src = propertyData.matterportEmbedUrl;
            }
            
            // Populate Roadmap Phases
            const roadmapContainer = document.getElementById('roadmap-phases');
            if (roadmapContainer && propertyData.roadmapPhases) {
                let roadmapHtml = '';
                propertyData.roadmapPhases.forEach((phase, index) => {
                    const isActive = index === 0;
                    roadmapHtml += `
                        <div class="bg-gradient-to-br ${isActive ? 'from-blue-600 to-blue-800' : 'from-gray-100 to-gray-200'} rounded-xl p-6 shadow-lg border ${isActive ? 'border-blue-500' : 'border-gray-300'}">
                            <div class="text-center">
                                <div class="text-sm font-semibold ${isActive ? 'text-blue-100' : 'text-gray-600'} mb-2">${phase.label}</div>
                                <div class="text-3xl font-extrabold ${isActive ? 'text-white' : 'text-gray-800'} mb-2">${currencyFormat.format(phase.price)}</div>
                                <div class="text-xs ${isActive ? 'text-blue-200' : 'text-gray-500'}">${currencyFormat.format(phase.price / propertyData.sqft)}/SqFt</div>
                            </div>
                        </div>
                    `;
                });
                roadmapContainer.innerHTML = roadmapHtml;
            }
            
            // Populate Financial Analysis
            const financialPrice = document.getElementById('financial-price');
            if (financialPrice) financialPrice.textContent = currencyFormat.format(propertyData.price);
            
            const financialSqft = document.getElementById('financial-sqft');
            if (financialSqft) financialSqft.textContent = propertyData.sqft.toLocaleString() + ' SqFt';
            
            const financialPpsf = document.getElementById('financial-ppsf');
            if (financialPpsf) financialPpsf.textContent = currencyFormat.format(propertyData.price / propertyData.sqft) + '/SqFt';
            
            const financialYear = document.getElementById('financial-year');
            if (financialYear) financialYear.textContent = propertyData.yearBuilt;
            
            const financialCdom = document.getElementById('financial-cdom');
            if (financialCdom) financialCdom.textContent = propertyData.cdom + ' Days';
            
            const financialFloor = document.getElementById('financial-floor');
            if (financialFloor) financialFloor.textContent = currencyFormat.format(propertyData.priceFloor);
            
            const financialRate = document.getElementById('financial-rate');
            if (financialRate) financialRate.textContent = (propertyData.marketRate * 100).toFixed(2) + '%';
            
            const financialReduction = document.getElementById('financial-reduction');
            if (financialReduction) {
                const reduction = propertyData.price - propertyData.priceFloor;
                financialReduction.textContent = currencyFormat.format(reduction) + ' (' + ((reduction / propertyData.price) * 100).toFixed(2) + '%)';
            }
        }

        window.onload = function() {
            try {
                // 0. Populate propertyData values first
                populatePropertyData();
                
                // 1. Calculate Option 3 totals first (depends on amortization schedule)
                calculateOption3Totals();
                
                // 2. Attach ALL event handlers *after* the DOM is fully loaded
                attachEventListeners();
                
                // 3. Populate all dynamic fields and tables
                populateAllCompTables();
                populateOptions();
                populateAmortizationTable();
                populateCompleteAmortizationTable(); 
                
                // 4. Initialize charts
                initCharts();

                // 5. Set default page
                showTab('summary');
            } catch (error) {
                console.error('Error during page initialization:', error);
                // Still try to show the page even if there are errors
                try {
                    attachEventListeners();
                    showTab('summary');
                } catch (e) {
                    console.error('Critical error preventing page display:', e);
                }
            }
        };
    </script>
</body>
</html>